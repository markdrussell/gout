-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/cleaning_dataset.log
  log type:  text
 opened on:  23 Feb 2023, 14:06:45

. 
. !gunzip "$projectdir/output/input.csv.gz"


. import delimited "$projectdir/output/input.csv", clear
(75 vars, 100,000 obs)

. 
. **Set Ado file path
. adopath + "$projectdir/analysis/extra_ados"
  [1]  (BASE)      "/usr/local/stata/ado/base/"
  [2]  (SITE)      "/usr/local/ado/"
  [3]              "."
  [4]  (PERSONAL)  "~/ado/personal/"
  [5]  (PLUS)      "~/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/workspace/analysis/extra_ados"

. 
. **Set index dates ===========================================================
> */
. global year_preceding = "01/01/2014"

. global start_date = "01/01/2015"

. global end_date = "31/12/2022"

. 
. **Rename variables =======================================*/
. rename chronic_respiratory_disease chronic_resp_disease

. rename chronic_cardiac_disease chronic_card_disease

. rename bmi_date_measured bmi_date

. 
. foreach var of varlist   bmi                                                 
>            ///
>                                                  creatinine                  
>                                    ///
>                                                  hba1c_mmol_per_mol          
>                            ///
>                                                  hba1c_percentage            
>                            ///
>                                                  urate_test_?                
>                            ///
>                                                  {
  2.                         rename `var' `var'_val
  3.                         order `var'_val, after(`var'_date)
  4.                 }

. 
. foreach var of varlist   died_date_ons                                       
>    ///
>                                                  chronic_card_disease        
>                    ///
>                                                  diabetes                    
>                                    ///
>                                                  hypertension                
>                            ///     
>                                                  chronic_resp_disease        
>                    ///
>                                                  copd                        
>                                    ///
>                                                  chronic_liver_disease       
>                    ///
>                                                  stroke                      
>                                    ///
>                                                  lung_cancer                 
>                            ///
>                                                  haem_cancer                 
>                            ///
>                                                  other_cancer                
>                            ///
>                                                  esrf                        
>                                    ///
>                                                  organ_transplant            
>                            ///
>                                                  gout_flare_?                
>                            ///
>                                                  gout_code_any_?             
>                            ///
>                                                  flare_treatment_?           
>                            ///
>                                                  gout_admission_?            
>                            ///     
>                                                  gout_emerg_?                
>                            ///
>                                                  {
  2.                         rename `var' `var'_date
  3.                 } 

.                 
. **Change date format and create binary indicator variables for relevant condi
> tions ====================================================*/
. 
. foreach var of varlist   gout_code_date                                      
>    ///
>                                                  first_ult_date              
>                            ///
>                                                  first_allo_date             
>                            ///
>                                                  first_febux_date            
>                            ///
>                                                  bmi_date                    
>                                    ///
>                                                  creatinine_date             
>                            ///
>                                                  died_date_ons               
>                            ///
>                                                  chronic_card_disease_date   
>                    ///
>                                                  diabetes_date               
>                            ///
>                                                  hypertension_date           
>                            ///     
>                                                  chronic_resp_disease_date   
>                    ///
>                                                  copd_date                   
>                                    ///
>                                                  chronic_liver_disease_date  
>                    ///
>                                                  stroke_date                 
>                            ///
>                                                  lung_cancer_date            
>                            ///
>                                                  haem_cancer_date            
>                            ///
>                                                  other_cancer_date           
>                            ///
>                                                  esrf_date                   
>                                    ///
>                                                  organ_transplant_date       
>                    ///
>                                                  hba1c_mmol_per_mol_date     
>                    ///
>                                                  hba1c_percentage_date       
>                    ///
>                                                  diuretic_date               
>                            ///
>                                                  gout_admission_?_date       
>                    ///
>                                                  gout_admission_pre_date     
>                    ///
>                                                  gout_emerg_?_date           
>                            ///
>                                                  gout_emerg_pre_date         
>                    ///
>                                                  tophi_date                  
>                                    ///
>                                                  gout_flare_?_date           
>                            ///
>                                                  gout_code_any_?_date        
>                    ///
>                                                  flare_treatment_?_date      
>                    ///
>                                                  urate_test_?_date           
>                            ///
>                                                  {              
  2.                                                         
.         /*date ranges are applied in python, so presence of date indicates pr
> esence of 
>           disease in the correct time frame*/ 
.           
.           capture confirm string variable `var'
  3.                 if _rc!=0 {
  4.                         assert `var'==.
  5.                         rename `var' `var'_Y
  6.                 }
  7.                 else {
  8.                                 rename `var' `var'_dstr
  9.                                 gen `var'_Y = date(`var'_dstr, "YMD") 
 10.                                 order `var'_Y, after(`var'_dstr)
 11.                                 drop `var'_dstr
 12.                                 rename `var'_Y `var'
 13.                 }
 14.         format `var' %td
 15.         local newvar =  substr("`var'", 1, length("`var'") - 5)
 16.         gen `newvar' = (`var'!=. )
 17.         order `newvar', after(`var')
 18. }
(1,000 missing values generated)
(30,000 missing values generated)
(40,000 missing values generated)
(80,000 missing values generated)
(40,000 missing values generated)
(5,000 missing values generated)
(95,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(80,000 missing values generated)
(5,000 missing values generated)
(5,000 missing values generated)
(80,000 missing values generated)
(70,000 missing values generated)
(70,000 missing values generated)
(70,000 missing values generated)
(95,000 missing values generated)
(70,000 missing values generated)
(70,000 missing values generated)
(70,000 missing values generated)
(95,000 missing values generated)
(80,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(50,000 missing values generated)
(50,000 missing values generated)
(50,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(60,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)
(30,000 missing values generated)

. 
. **For repeated measures, change number to end of variable number (for reshapi
> ng)
.                 
. forval i = 1/7  {
  2.                                         rename urate_test_`i'_date urate_d
> ate_`i'
  3.                                         order urate_test_`i', after(urate_
> date_`i')
  4.                                         rename urate_test_`i'_val urate_va
> l_`i'
  5. }

. 
. forval i = 1/3  {
  2.                                         rename gout_flare_`i'_date gout_fl
> are_date_`i'
  3.                                         rename gout_code_any_`i'_date gout
> _code_any_date_`i'
  4.                                         rename gout_emerg_`i'_date gout_em
> erg_date_`i'
  5.                                         rename gout_admission_`i'_date  go
> ut_admission_date_`i' 
  6. }

. 
. forval i = 1/6  {
  2.                                         rename flare_treatment_`i'_date fl
> are_treatment_date_`i'                                        
  3. }

.                                         
. **Create and label variables ================================================
> ===========*/
. 
. **Demographics
. ***Sex
. gen male = 1 if sex == "M"
(51,120 missing values generated)

. replace male = 0 if sex == "F"
(51,120 real changes made)

. lab var male "Male"

. lab define male 0 "No" 1 "Yes", modify

. lab val male male

. tab male, missing

       Male |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     51,120       51.12       51.12
        Yes |     48,880       48.88      100.00
------------+-----------------------------------
      Total |    100,000      100.00

. 
. ***Ethnicity
. replace ethnicity = .u if ethnicity == .
(25,000 real changes made, 25,000 to missing)

. ****rearrange in order of prevalence
. recode ethnicity 2=6 /* mixed to 6 */
(ethnicity: 14931 changes made)

. recode ethnicity 3=2 /* south asian to 2 */
(ethnicity: 7424 changes made)

. recode ethnicity 4=3 /* black to 3 */
(ethnicity: 7596 changes made)

. recode ethnicity 6=4 /* mixed to 4 */
(ethnicity: 14931 changes made)

. recode ethnicity 5=4 /* other to 4 */
(ethnicity: 7499 changes made)

. 
. label define ethnicity  1 "White"                                       ///
>                                                 2 "Asian/Asian British"      
>    ///
>                                                 3 "Black"                    
>                    ///
>                                                 4 "Mixed/Other"              
>            ///
>                                                 .u "Not known"

. label values ethnicity ethnicity

. lab var ethnicity "Ethnicity"

. tab ethnicity, missing

          Ethnicity |      Freq.     Percent        Cum.
--------------------+-----------------------------------
              White |     37,550       37.55       37.55
Asian/Asian British |      7,424        7.42       44.97
              Black |      7,596        7.60       52.57
        Mixed/Other |     22,430       22.43       75.00
          Not known |     25,000       25.00      100.00
--------------------+-----------------------------------
              Total |    100,000      100.00

. 
. gen ethnicity_bme=0 if ethnicity==1
(62,450 missing values generated)

. replace ethnicity_bme=1 if ethnicity>1 & ethnicity<5
(37,450 real changes made)

. replace ethnicity_bme=.u if ethnicity==.u
(25,000 real changes made, 25,000 to missing)

. label define ethnicity_bme      0 "White"               ///
>                                                 1 "Non-white"           ///
>                                                 .u "Not known"

. label values ethnicity_bme ethnicity_bme

. lab var ethnicity_bme "Ethnicity"

. tab ethnicity_bme, missing

  Ethnicity |      Freq.     Percent        Cum.
------------+-----------------------------------
      White |     37,550       37.55       37.55
  Non-white |     37,450       37.45       75.00
  Not known |     25,000       25.00      100.00
------------+-----------------------------------
      Total |    100,000      100.00

. 
. ***STP 
. rename stp stp_old

. bysort stp_old: gen stp = 1 if _n==1
(99,998 missing values generated)

. replace stp = sum(stp) //
(99,999 real changes made)

. drop stp_old

. 
. ***Regions
. encode region, gen(nuts_region)

. tab region, missing

                  region |      Freq.     Percent        Cum.
-------------------------+-----------------------------------
                         |      1,000        1.00        1.00
                    East |     10,114       10.11       11.11
           East Midlands |     10,008       10.01       21.12
                  London |     19,683       19.68       40.80
              North East |      9,799        9.80       50.60
              North West |      9,909        9.91       60.51
              South East |      9,784        9.78       70.30
              South West |      9,927        9.93       80.22
           West Midlands |      9,897        9.90       90.12
Yorkshire and The Humber |      9,879        9.88      100.00
-------------------------+-----------------------------------
                   Total |    100,000      100.00

. replace region="Not known" if region==""
(1,000 real changes made)

. gen region_nospace=region

. replace region_nospace="SouthWest" if region=="South West"
(9,927 real changes made)

. replace region_nospace="EastMidlands" if region=="East Midlands"
(10,008 real changes made)

. replace region_nospace="East" if region=="East"
(0 real changes made)

. replace region_nospace="London" if region=="London"
(0 real changes made)

. replace region_nospace="NorthEast" if region=="North East"
(9,799 real changes made)

. replace region_nospace="NorthWest" if region=="North West"
(9,909 real changes made)

. replace region_nospace="SouthEast" if region=="South East"
(9,784 real changes made)

. replace region_nospace="WestMidlands" if region=="West Midlands"
(9,897 real changes made)

. replace region_nospace="YorkshireandTheHumber" if region=="Yorkshire and The 
> Humber"
(9,879 real changes made)

. drop region

. 
. ***IMD
. recode imd 0 = .u
(imd: 4979 changes made)

. label define imd 1 "1 most deprived" 2 "2" 3 "3" 4 "4" 5 "5 least deprived" .
> u "Not known"

. label values imd imd 

. lab var imd "Index of multiple deprivation"

. tab imd, missing

        Index of |
        multiple |
     deprivation |      Freq.     Percent        Cum.
-----------------+-----------------------------------
 1 most deprived |     18,791       18.79       18.79
               2 |     19,048       19.05       37.84
               3 |     19,069       19.07       56.91
               4 |     19,142       19.14       76.05
5 least deprived |     18,971       18.97       95.02
       Not known |      4,979        4.98      100.00
-----------------+-----------------------------------
           Total |    100,000      100.00

. 
. ***Age variables
. *Nb. works if ages 18 and over
. *Create categorised age
. drop if age<18 & age !=.
(21,096 observations deleted)

. drop if age>109 & age !=.
(0 observations deleted)

. drop if age==.
(0 observations deleted)

. lab var age "Age"

. 
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(78904 differences between age and agegroup)

. 
. label define agegroup   1 "18-39" ///
>                                                 2 "40-49" ///
>                                                 3 "50-59" ///
>                                                 4 "60-69" ///
>                                                 5 "70-79" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. lab var agegroup "Age group"

. tab agegroup, missing

  Age group |      Freq.     Percent        Cum.
------------+-----------------------------------
      18-39 |     28,787       36.48       36.48
      40-49 |     12,742       16.15       52.63
      50-59 |     13,209       16.74       69.37
      60-69 |     10,640       13.48       82.86
      70-79 |      8,389       10.63       93.49
        80+ |      5,137        6.51      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. ***Body Mass Index
. *Recode strange values 
. replace bmi_val = . if bmi_val == 0 
(31,517 real changes made, 31,517 to missing)

. replace bmi_val = . if !inrange(bmi_val, 10, 80)
(263 real changes made, 263 to missing)

. 
. *Restrict to within 10 years of gout diagnosis date and aged>16 
. gen bmi_time = (gout_code_date - bmi_date)/365.25
(32,012 missing values generated)

. gen bmi_age = age - bmi_time
(32,012 missing values generated)

. replace bmi_val = . if bmi_age < 16 
(32,484 real changes made, 32,484 to missing)

. replace bmi_val = . if bmi_time > 10 & bmi_time != . 
(8,834 real changes made, 8,834 to missing)

. 
. *Set to missing if no date, and vice versa 
. replace bmi_val = . if bmi_date == . 
(0 real changes made)

. replace bmi_date = . if bmi_val == . 
(41,581 real changes made, 41,581 to missing)

. replace bmi_time = . if bmi_val == . 
(41,577 real changes made, 41,577 to missing)

. replace bmi_age = . if bmi_val == . 
(41,577 real changes made, 41,577 to missing)

. 
. *Create BMI categories
. gen     bmicat = .
(78,904 missing values generated)

. recode  bmicat . = 1 if bmi_val < 18.5
(bmicat: 287 changes made)

. recode  bmicat . = 2 if bmi_val < 25
(bmicat: 669 changes made)

. recode  bmicat . = 3 if bmi_val < 30
(bmicat: 896 changes made)

. recode  bmicat . = 4 if bmi_val < 35
(bmicat: 1063 changes made)

. recode  bmicat . = 5 if bmi_val < 40
(bmicat: 1084 changes made)

. recode  bmicat . = 6 if bmi_val < .
(bmicat: 1807 changes made)

. replace bmicat = .u if bmi_val >= .
(73,098 real changes made, 73,098 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                  
>    ///
>                                         .u "Not known"

.                                         
. label values bmicat bmicat

. lab var bmicat "BMI"

. tab bmicat, missing

                 BMI |      Freq.     Percent        Cum.
---------------------+-----------------------------------
 Underweight (<18.5) |        287        0.36        0.36
  Normal (18.5-24.9) |        669        0.85        1.21
Overweight (25-29.9) |        896        1.14        2.35
   Obese I (30-34.9) |      1,063        1.35        3.69
  Obese II (35-39.9) |      1,084        1.37        5.07
     Obese III (40+) |      1,807        2.29        7.36
           Not known |     73,098       92.64      100.00
---------------------+-----------------------------------
               Total |     78,904      100.00

. 
. *Create less granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(78617 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"        
>    ///
>                                                 3 "Obese II (35-39.9)"       
>    ///
>                                                 4 "Obese III (40+)"          
>    

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. 
. ***Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Not known"

. 
. gen     smoke = 1  if smoking_status == "N"
(71,026 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(3,946 real changes made)

. replace smoke = 3  if smoking_status == "S"
(23,704 real changes made)

. replace smoke = .u if smoking_status == "M"
(3,927 real changes made, 3,927 to missing)

. replace smoke = .u if smoking_status == "" 
(39,449 real changes made, 39,449 to missing)

. 
. label values smoke smoke

. lab var smoke "Smoking status"

. drop smoking_status

. tab smoke, missing

    Smoking |
     status |      Freq.     Percent        Cum.
------------+-----------------------------------
      Never |      7,878        9.98        9.98
     Former |      3,946        5.00       14.99
    Current |     23,704       30.04       45.03
  Not known |     43,376       54.97      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *Create non-missing 3-category variable for current smoking (assumes missing 
> smoking is never smoking)
. recode smoke .u = 1, gen(smoke_nomiss)
(43376 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. **Clinical comorbidities
. ***eGFR
. *Set implausible creatinine values to missing (Note: zero changed to missing)
. replace creatinine_val = . if !inrange(creatinine_val, 20, 3000) 
(19,900 real changes made, 19,900 to missing)

. 
. *Remove creatinine dates if no measurements, and vice versa 
. replace creatinine_val = . if creatinine_date == . 
(0 real changes made)

. replace creatinine_date = . if creatinine_val == . 
(15,930 real changes made, 15,930 to missing)

. replace creatinine = . if creatinine_val == .
(19,900 real changes made, 19,900 to missing)

. recode creatinine .=0
(creatinine: 19900 changes made)

. tab creatinine, missing

 creatinine |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     19,900       25.22       25.22
          1 |     59,004       74.78      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *Divide by 88.4 (to convert umol/l to mg/dl) 
. gen SCr_adj = creatinine_val/88.4
(19,900 missing values generated)

. 
. gen min = .
(78,904 missing values generated)

. replace min = SCr_adj/0.7 if male==0
(30,214 real changes made)

. replace min = SCr_adj/0.9 if male==1
(28,790 real changes made)

. replace min = min^-0.329  if male==0
(30,214 real changes made)

. replace min = min^-0.411  if male==1
(28,790 real changes made)

. replace min = 1 if min<1
(45,981 real changes made)

. 
. gen max=.
(78,904 missing values generated)

. replace max=SCr_adj/0.7 if male==0
(30,214 real changes made)

. replace max=SCr_adj/0.9 if male==1
(28,790 real changes made)

. replace max=max^-1.209
(59,004 real changes made)

. replace max=1 if max>1
(32,923 real changes made)

. 
. gen egfr=min*max*141
(19,900 missing values generated)

. replace egfr=egfr*(0.993^age)
(59,004 real changes made)

. replace egfr=egfr*1.018 if male==0
(30,214 real changes made)

. label var egfr "egfr calculated using CKD-EPI formula with no ethnicity"

. 
. *Categorise into ckd stages
. egen egfr_cat_all = cut(egfr), at(0, 15, 30, 45, 60, 5000)
(19900 missing values generated)

. recode egfr_cat_all 0 = 5 15 = 4 30 = 3 45 = 2 60 = 0, generate(ckd_egfr)
(59004 differences between egfr_cat_all and ckd_egfr)

. 
. gen egfr_cat = .
(78,904 missing values generated)

. recode egfr_cat . = 3 if egfr < 30
(egfr_cat: 13807 changes made)

. recode egfr_cat . = 2 if egfr < 60
(egfr_cat: 20920 changes made)

. recode egfr_cat . = 1 if egfr < .
(egfr_cat: 24277 changes made)

. replace egfr_cat = .u if egfr >= .
(19,900 real changes made, 19,900 to missing)

. 
. label define egfr_cat   1 ">=60"                ///
>                                                 2 "30-59"               ///
>                                                 3 "<30"                 ///
>                                                 .u "Not known"

.                                         
. label values egfr_cat egfr_cat

. lab var egfr_cat "eGFR"

. tab egfr_cat, missing

       eGFR |      Freq.     Percent        Cum.
------------+-----------------------------------
       >=60 |     24,277       30.77       30.77
      30-59 |     20,920       26.51       57.28
        <30 |     13,807       17.50       74.78
  Not known |     19,900       25.22      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *If missing eGFR, assume normal
. gen egfr_cat_nomiss = egfr_cat
(19,900 missing values generated)

. replace egfr_cat_nomiss = 1 if egfr_cat == .u
(19,900 real changes made)

. 
. label define egfr_cat_nomiss    1 ">=60/not known"      ///
>                                                                 2 "30-59"    
>                    ///
>                                                                 3 "<30" 

. label values egfr_cat_nomiss egfr_cat_nomiss

. lab var egfr_cat_nomiss "eGFR"

. tab egfr_cat_nomiss, missing

          eGFR |      Freq.     Percent        Cum.
---------------+-----------------------------------
>=60/not known |     44,177       55.99       55.99
         30-59 |     20,920       26.51       82.50
           <30 |     13,807       17.50      100.00
---------------+-----------------------------------
         Total |     78,904      100.00

. 
. gen egfr_date = creatinine_date
(19,900 missing values generated)

. format egfr_date %td

. 
. *Add in end stage renal failure and create a single CKD variable 
. *Missing assumed to not have CKD 
. gen ckd = 0

. replace ckd = 1 if ckd_egfr != . & ckd_egfr >= 1
(34,727 real changes made)

. replace ckd = 1 if esrf == 1
(8,828 real changes made)

. 
. label define ckd 0 "No" 1 "Yes"

. label values ckd ckd

. label var ckd "Chronic kidney disease"

. tab ckd, missing

    Chronic |
     kidney |
    disease |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     35,349       44.80       44.80
        Yes |     43,555       55.20      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *Create date (most recent measure prior to index)
. gen temp1_ckd_date = creatinine_date if ckd_egfr >=1
(44,177 missing values generated)

. gen temp2_ckd_date = esrf_date if esrf == 1
(63,153 missing values generated)

. gen ckd_date = max(temp1_ckd_date,temp2_ckd_date) 
(35,349 missing values generated)

. format ckd_date %td 

. 
. drop temp1_ckd_date temp2_ckd_date SCr_adj min max ckd_egfr egfr_cat_all

. 
. ***HbA1c
. *Set zero or negative to missing
. replace hba1c_percentage_val   = . if hba1c_percentage_val <= 0
(4,407 real changes made, 4,407 to missing)

. replace hba1c_mmol_per_mol_val = . if hba1c_mmol_per_mol_val <= 0
(5,690 real changes made, 5,690 to missing)

. 
. *Change implausible values to missing
. replace hba1c_percentage_val   = . if !inrange(hba1c_percentage_val, 1, 20)
(1,244 real changes made, 1,244 to missing)

. replace hba1c_mmol_per_mol_val = . if !inrange(hba1c_mmol_per_mol_val, 10, 20
> 0)
(3,418 real changes made, 3,418 to missing)

. 
. *Set most recent values of >24 months prior to gout diagnosis date to missing
. replace hba1c_percentage_val   = . if (gout_code_date - hba1c_percentage_date
> ) > 24*30 & hba1c_percentage_date != .
(69,298 real changes made, 69,298 to missing)

. replace hba1c_mmol_per_mol_val = . if (gout_code_date - hba1c_mmol_per_mol_da
> te) > 24*30 & hba1c_mmol_per_mol_date != .
(66,163 real changes made, 66,163 to missing)

. 
. *Clean up dates
. replace hba1c_percentage_date = . if hba1c_percentage_val == .
(70,992 real changes made, 70,992 to missing)

. replace hba1c_mmol_per_mol_date = . if hba1c_mmol_per_mol_val == .
(71,335 real changes made, 71,335 to missing)

. 
. *Express HbA1c as percentage
. *Express all values as perecentage 
. noi summ hba1c_percentage_val hba1c_mmol_per_mol_val 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
hba1c_perc~l |      3,955    5.109918    1.876354   1.009497   12.11197
hba1c_mmo~al |      3,633     42.8525    17.45531   10.03046    114.785

. gen     hba1c_pct = hba1c_percentage_val 
(74,949 missing values generated)

. replace hba1c_pct = (hba1c_mmol_per_mol_val/10.929)+2.15 if hba1c_mmol_per_mo
> l_val<. 
(3,633 real changes made)

. 
. *Valid % range between 0-20  
. replace hba1c_pct = . if !inrange(hba1c_pct, 1, 20) 
(0 real changes made)

. replace hba1c_pct = round(hba1c_pct, 0.1)
(7,388 real changes made)

. 
. *Categorise HbA1c and diabetes
. *Group hba1c pct
. gen     hba1ccat = 0 if hba1c_pct <  6.5
(73,856 missing values generated)

. replace hba1ccat = 1 if hba1c_pct >= 6.5  & hba1c_pct < 7.5
(1,205 real changes made)

. replace hba1ccat = 2 if hba1c_pct >= 7.5  & hba1c_pct < 8
(406 real changes made)

. replace hba1ccat = 3 if hba1c_pct >= 8    & hba1c_pct < 9
(476 real changes made)

. replace hba1ccat = 4 if hba1c_pct >= 9    & hba1c_pct !=.
(253 real changes made)

. label define hba1ccat 0 "<6.5%" 1">=6.5-7.4" 2">=7.5-7.9" 3">=8-8.9" 4">=9"

. label values hba1ccat hba1ccat

. tab hba1ccat, missing

   hba1ccat |      Freq.     Percent        Cum.
------------+-----------------------------------
      <6.5% |      5,048        6.40        6.40
  >=6.5-7.4 |      1,205        1.53        7.92
  >=7.5-7.9 |        406        0.51        8.44
    >=8-8.9 |        476        0.60        9.04
        >=9 |        253        0.32        9.36
          . |     71,516       90.64      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *Express all values as mmol
. gen hba1c_mmol = hba1c_mmol_per_mol_val
(75,271 missing values generated)

. replace hba1c_mmol = (hba1c_percentage_val*10.929)-23.5 if hba1c_percentage_v
> al<. & hba1c_mmol==.
(3,755 real changes made)

. 
. *Group hba1c mmol
. gen     hba1ccatmm = 0 if hba1c_mmol < 58
(72,645 missing values generated)

. replace hba1ccatmm = 1 if hba1c_mmol >= 58 & hba1c_mmol !=.
(1,129 real changes made)

. replace hba1ccatmm =.u if hba1ccatmm==. 
(71,516 real changes made, 71,516 to missing)

. label define hba1ccatmm 0 "HbA1c <58mmol/mol" 1 "HbA1c >=58mmol/mol" .u "Not 
> known"

. label values hba1ccatmm hba1ccatmm

. lab var hba1ccatmm "HbA1c"

. tab hba1ccatmm, missing

             HbA1c |      Freq.     Percent        Cum.
-------------------+-----------------------------------
 HbA1c <58mmol/mol |      6,259        7.93        7.93
HbA1c >=58mmol/mol |      1,129        1.43        9.36
         Not known |     71,516       90.64      100.00
-------------------+-----------------------------------
             Total |     78,904      100.00

. 
. *Create diabetes, split by control/not (assumes missing = no diabetes)
. gen     diabcatm = 1 if diabetes==0
(15,764 missing values generated)

. replace diabcatm = 2 if diabetes==1 & hba1ccatmm==0
(1,248 real changes made)

. replace diabcatm = 3 if diabetes==1 & hba1ccatmm==1
(221 real changes made)

. replace diabcatm = 4 if diabetes==1 & hba1ccatmm==.u
(14,295 real changes made)

. 
. label define diabcatm   1 "No diabetes"                         ///
>                                                 2 "Diabetes with HbA1c <58mmo
> l/mol"             ///
>                                                 3 "Diabetes with HbA1c >58mmo
> l/mol"     ///
>                                                 4 "Diabetes with no HbA1c mea
> sure"

. label values diabcatm diabcatm

. lab var diabcatm "Diabetes"

. 
. *Create cancer variable
. gen cancer =0

. replace cancer =1 if lung_cancer ==1 | haem_cancer ==1 | other_cancer ==1
(38,487 real changes made)

. lab var cancer "Cancer"

. lab define cancer 0 "No" 1 "Yes", modify

. lab val cancer cancer

. tab cancer, missing

     Cancer |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     40,417       51.22       51.22
        Yes |     38,487       48.78      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. 
. *Create other comorbid variables
. gen combined_cv_comorbid =1 if chronic_card_disease ==1 | stroke==1
(50,394 missing values generated)

. recode combined_cv_comorbid .=0
(combined_cv_comorbid: 50394 changes made)

. 
. *Define tophaceous disease as a code for tophaecous gout at baseline or withi
> n 3m of diagnosis
. gen time_to_tophus = tophi_date-gout_code_date if tophi_date!=. & gout_code_d
> ate!=.
(63,331 missing values generated)

. gen tophus = 1 if time_to_tophus<90 & time_to_tophus!=.
(70,713 missing values generated)

. recode tophus .=0
(tophus: 70713 changes made)

. 
. *Recode missing as zero for other variable
. recode diuretic .=0
(diuretic: 0 changes made)

. 
. *Label variables
. lab var hypertension "Hypertension"

. lab define hypertension 0 "No" 1 "Yes", modify

. lab val hypertension hypertension

. lab var diabetes "Diabetes"

. lab define diabetes 0 "No" 1 "Yes", modify

. lab val diabetes diabetes

. lab var stroke "Stroke"

. lab define stroke 0 "No" 1 "Yes", modify

. lab val stroke stroke

. lab var chronic_resp_disease "Chronic respiratory disease"

. lab define chronic_resp_disease 0 "No" 1 "Yes", modify

. lab val chronic_resp_disease chronic_resp_disease

. lab var copd "COPD"

. lab define copd 0 "No" 1 "Yes", modify

. lab val copd copd

. lab var esrf "End-stage renal failure"

. lab define esrf 0 "No" 1 "Yes", modify

. lab val esrf esrf

. lab var chronic_liver_disease "Chronic liver disease"

. lab define chronic_liver_disease 0 "No" 1 "Yes", modify

. lab val chronic_liver_disease chronic_liver_disease

. lab var chronic_card_disease "Chronic cardiac disease"

. lab define chronic_card_disease 0 "No" 1 "Yes", modify

. lab val chronic_card_disease chronic_card_disease

. lab define diuretic 0 "No" 1 "Yes", modify

. lab val diuretic diuretic

. lab var diuretic "Diuretic at diagnosis"

. lab define tophus 0 "No" 1 "Yes", modify

. lab val tophus tophus

. lab var tophus "Tophaceous gout"

. 
. *Ensure everyone has gout code===============================================
> ==============*/
. 
. tab gout_code, missing

  gout_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        803        1.02        1.02
          1 |     78,101       98.98      100.00
------------+-----------------------------------
      Total |     78,904      100.00

. keep if gout_code==1
(803 observations deleted)

. 
. *Generate diagnosis date=====================================================
> ==========*/
. 
. *Use first gout code date (in GP record) as diagnosis date
. gen diagnosis_date=gout_code_date

. format diagnosis_date %td

. 
. *Refine diagnostic window====================================================
> =========*/
. 
. **Keep patients with diagnosis date was after study start date and before end
>  date
. keep if diagnosis_date>=date("$start_date", "DMY") & diagnosis_date!=. 
(8,473 observations deleted)

. tab gout_code, missing

  gout_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     69,628      100.00      100.00
------------+-----------------------------------
      Total |     69,628      100.00

. keep if diagnosis_date<date("$end_date", "DMY") & diagnosis_date!=. 
(1,207 observations deleted)

. tab gout_code, missing

  gout_code |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     68,421      100.00      100.00
------------+-----------------------------------
      Total |     68,421      100.00

. 
. *Check if first ULT prescription was before index diagnosis code=============
> ========================================*/
. 
. **Date of first ULT script
. codebook first_ult_date

-------------------------------------------------------------------------------
first_ult_date                                                      (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric daily date (float)

                 range:  [19360,23062]                units:  1
       or equivalently:  [02jan2013,21feb2023]        units:  days
         unique values:  3,703                    missing .:  20,570/68,421

                  mean:   21215.4 = 31jan2018 (+ 11 hours)
              std. dev:   1072.96

           percentiles:        10%       25%       50%       75%       90%
                             19724     20283     21218     22148     22702
                         01jan2014 14jul2015 03feb2018 21aug2020 26feb2022

. 
. tab first_ult if gout_code_date!=. & first_ult_date!=. & first_ult_date<gout_
> code_date

  first_ult |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     28,180      100.00      100.00
------------+-----------------------------------
      Total |     28,180      100.00

. tab first_ult if gout_code_date!=. & first_ult_date!=. & (first_ult_date+30)<
> gout_code_date //30 days before

  first_ult |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     27,780      100.00      100.00
------------+-----------------------------------
      Total |     27,780      100.00

. tab first_ult if gout_code_date!=. & first_ult_date!=. & (first_ult_date+60)<
> gout_code_date //60 days before

  first_ult |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     27,440      100.00      100.00
------------+-----------------------------------
      Total |     27,440      100.00

. drop if gout_code_date!=. & first_ult_date!=. & (first_ult_date+30)<gout_code
> _date //drop if first ULT script more than 30 days before first gout code - t
> hink about what to do with these (don't drop?)
(27,780 observations deleted)

. 
. *Recode index diagnosis date as first ULT date if first ULT date <30 days bef
> ore index gout code date
. replace gout_code_date=first_ult_date if gout_code_date!=. & first_ult_date!=
> . & (first_ult_date<gout_code_date)
(400 real changes made)

. 
. *Check if first gout admission/emergency attendance was before index diagnosi
> s code=====================================================*/
. 
. tab gout_admission_pre //admissions for gout that were more than 30 days befo
> re gout code

gout_admiss |
    ion_pre |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     38,577       94.92       94.92
          1 |      2,064        5.08      100.00
------------+-----------------------------------
      Total |     40,641      100.00

. drop if gout_admission_pre==1 //drop those with gout admissions that were mor
> e than 30 days before GP gout code 
(2,064 observations deleted)

. 
. tab gout_admission_1 //admissions for gout that were from 30 days before gout
>  code and onwards

gout_admiss |
      ion_1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     26,971       69.91       69.91
          1 |     11,606       30.09      100.00
------------+-----------------------------------
      Total |     38,577      100.00

. tab gout_admission_1 if gout_code_date!=. & gout_admission_date_1!=. & gout_a
> dmission_date_1<gout_code_date

gout_admiss |
      ion_1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      5,468      100.00      100.00
------------+-----------------------------------
      Total |      5,468      100.00

. tab gout_admission_1 if gout_code_date!=. & gout_admission_date_1!=. & (gout_
> admission_date_1+30)<gout_code_date //30 days before - should be accounted fo
> r by study definition - check

gout_admiss |
      ion_1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      5,356      100.00      100.00
------------+-----------------------------------
      Total |      5,356      100.00

. 
. *Recode index diagnosis date as gout admission date if gout admission date le
> ss than 30 days before index gout code date
. replace gout_code_date=gout_admission_date_1 if gout_code_date!=. & first_ult
> _date!=. & (gout_admission_date_1<gout_code_date)
(2,289 real changes made)

. 
. tab gout_emerg_pre //ED attendances for gout that were more than 30 days befo
> re gout code

gout_emerg_ |
        pre |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     36,635       94.97       94.97
          1 |      1,942        5.03      100.00
------------+-----------------------------------
      Total |     38,577      100.00

. drop if gout_emerg_pre==1 //drop those with gout ED attendances that were mor
> e than 30 days before GP gout code 
(1,942 observations deleted)

. 
. tab gout_emerg_1 //ED attendances for gout that were from 30 days before gout
>  code and onwards

gout_emerg_ |
          1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     25,684       70.11       70.11
          1 |     10,951       29.89      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab gout_emerg_1 if gout_code_date!=. & gout_emerg_date_1!=. & gout_emerg_dat
> e_1<gout_code_date

gout_emerg_ |
          1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,970      100.00      100.00
------------+-----------------------------------
      Total |      4,970      100.00

. tab gout_emerg_1 if gout_code_date!=. & gout_emerg_date_1!=. & (gout_emerg_da
> te_1+30)<gout_code_date //check

gout_emerg_ |
          1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      4,857      100.00      100.00
------------+-----------------------------------
      Total |      4,857      100.00

. 
. *Recode index diagnosis date as gout emerg date if gout emerg date less than 
> 30 days before index gout code date
. replace gout_code_date=gout_emerg_date_1 if gout_code_date!=. & first_ult_dat
> e!=. & (gout_emerg_date_1<gout_code_date)
(1,929 real changes made)

. 
. *Number of diagnoses in time windows=========================================
> */
. 
. **Month/Year of diagnosis code
. gen year_diag=year(gout_code_date)

. format year_diag %ty

. gen month_diag=month(gout_code_date)

. gen mo_year_diagn=ym(year_diag, month_diag)

. format mo_year_diagn %tmMon-CCYY

. generate str16 mo_year_diagn_s = strofreal(mo_year_diagn,"%tmCCYY!mNN")

. lab var mo_year_diagn "Month/Year of Diagnosis"

. lab var mo_year_diagn_s "Month/Year of Diagnosis"

. 
. **Separate into 12-month time windows (for diagnosis date)
. gen diagnosis_year=1 if diagnosis_date>=td(01jan2015) & diagnosis_date<=td(31
> dec2015)
(30,196 missing values generated)

. replace diagnosis_year=2 if diagnosis_date>=td(01jan2016) & diagnosis_date<=t
> d(31dec2016)
(5,958 real changes made)

. replace diagnosis_year=3 if diagnosis_date>=td(01jan2017) & diagnosis_date<=t
> d(31dec2017)
(5,488 real changes made)

. replace diagnosis_year=4 if diagnosis_date>=td(01jan2018) & diagnosis_date<=t
> d(31dec2018)
(4,816 real changes made)

. replace diagnosis_year=5 if diagnosis_date>=td(01jan2019) & diagnosis_date<=t
> d(31dec2019)
(4,251 real changes made)

. replace diagnosis_year=6 if diagnosis_date>=td(01jan2020) & diagnosis_date<=t
> d(31dec2020)
(3,709 real changes made)

. replace diagnosis_year=7 if diagnosis_date>=td(01jan2021) & diagnosis_date<=t
> d(31dec2021)
(3,213 real changes made)

. replace diagnosis_year=8 if diagnosis_date>=td(01jan2022) & diagnosis_date<=t
> d(31dec2022)
(2,761 real changes made)

. lab define diagnosis_year 1 "2015" 2 "2016" 3 "2017" 4 "2018" 5 "2019" 6 "202
> 0" 7 "2021" 8 "2022", modify

. lab val diagnosis_year diagnosis_year

. lab var diagnosis_year "Year of diagnosis"

. tab diagnosis_year, missing

    Year of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
       2015 |      6,439       17.58       17.58
       2016 |      5,958       16.26       33.84
       2017 |      5,488       14.98       48.82
       2018 |      4,816       13.15       61.97
       2019 |      4,251       11.60       73.57
       2020 |      3,709       10.12       83.69
       2021 |      3,213        8.77       92.46
       2022 |      2,761        7.54      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. *Prescription of ULT==================================================*/
. 
. **Check proportion of patients with at least 6/12 months of registration afte
> r diagnosis 
. tab has_6m_follow_up, missing

has_6m_foll |
      ow_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      1,822        4.97        4.97
          1 |     34,813       95.03      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab has_12m_follow_up, missing

has_12m_fol |
     low_up |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,662       10.00       10.00
          1 |     32,973       90.00      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. **Create variable whereby patients have at least 6/12 months of registration 
> and follow-up time after diagnosis
. gen has_6m_post_diag=1 if gout_code_date!=. & gout_code_date<(date("$end_date
> ", "DMY")-180) & has_6m_follow_up==1
(3,010 missing values generated)

. recode has_6m_post_diag .=0
(has_6m_post_diag: 3010 changes made)

. lab var has_6m_post_diag ">6m follow-up"

. lab define has_6m_post_diag 0 "No" 1 "Yes", modify

. lab val has_6m_post_diag has_6m_post_diag

. tab has_6m_post_diag, missing 

        >6m |
  follow-up |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,010        8.22        8.22
        Yes |     33,625       91.78      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. gen has_12m_post_diag=1 if gout_code_date!=. & gout_code_date<(date("$end_dat
> e", "DMY")-365) & has_12m_follow_up==1
(5,997 missing values generated)

. recode has_12m_post_diag .=0
(has_12m_post_diag: 5997 changes made)

. lab var has_12m_post_diag ">12m follow-up"

. lab define has_12m_post_diag 0 "No" 1 "Yes", modify

. lab val has_12m_post_diag has_12m_post_diag

. tab has_12m_post_diag, missing 

       >12m |
  follow-up |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      5,997       16.37       16.37
        Yes |     30,638       83.63      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. **Generate variable for time to first ULT prescription
. gen time_to_ult = first_ult_date-gout_code_date if first_ult_date!=. & gout_c
> ode_date!=.
(18,542 missing values generated)

. 
. **Generate variable for those who had ULT prescription within 6m of diagnosis
>  
. gen ult_6m = 1 if time_to_ult<=180 & time_to_ult!=.
(34,833 missing values generated)

. recode ult_6m .=0
(ult_6m: 34833 changes made)

. lab var ult_6m "ULT within 6 months of diagnosis"

. lab define ult_6m 0 "No" 1 "Yes", modify

. lab val ult_6m ult_6m

. tab ult_6m, missing

 ULT within |
6 months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     34,833       95.08       95.08
        Yes |      1,802        4.92      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab ult_6m if has_6m_post_diag==1, missing //for those with at least 6m of av
> ailable follow-up

 ULT within |
6 months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     31,979       95.10       95.10
        Yes |      1,646        4.90      100.00
------------+-----------------------------------
      Total |     33,625      100.00

. tab ult_6m if has_12m_post_diag==1, missing //for those with at least 12m of 
> available follow-up

 ULT within |
6 months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     29,134       95.09       95.09
        Yes |      1,504        4.91      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. **Generate variable for those who had ULT prescription within 12m of diagnosi
> s 
. gen ult_12m = 1 if time_to_ult<=365 & time_to_ult!=.
(33,261 missing values generated)

. recode ult_12m .=0
(ult_12m: 33261 changes made)

. lab var ult_12m "ULT within 12 months of diagnosis"

. lab define ult_12m 0 "No" 1 "Yes", modify

. lab val ult_12m ult_12m

. tab ult_12m, missing

 ULT within |
  12 months |
         of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     33,261       90.79       90.79
        Yes |      3,374        9.21      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab ult_12m if has_12m_post_diag==1, missing //for those with at least 12m of
>  available follow-up

 ULT within |
  12 months |
         of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     27,799       90.73       90.73
        Yes |      2,839        9.27      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. **Generate variable for time to first allopurinol prescription
. gen time_to_allo = first_allo_date-gout_code_date if first_allo_date!=. & gou
> t_code_date!=.
(14,615 missing values generated)

. 
. **Generate variable for those who had allopurinol prescription within 6m of d
> iagnosis 
. gen allo_6m = 1 if time_to_allo<=180 & time_to_allo!=.
(24,539 missing values generated)

. recode allo_6m .=0
(allo_6m: 24539 changes made)

. lab var allo_6m "Allopurinol within 6 months of diagnosis"

. lab define allo_6m 0 "No" 1 "Yes", modify

. lab val allo_6m allo_6m

. tab allo_6m, missing

Allopurinol |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     24,539       66.98       66.98
        Yes |     12,096       33.02      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab allo_6m if has_6m_post_diag==1, missing //for those with at least 6m of a
> vailable follow-up

Allopurinol |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     22,861       67.99       67.99
        Yes |     10,764       32.01      100.00
------------+-----------------------------------
      Total |     33,625      100.00

. tab allo_6m if has_12m_post_diag==1, missing //for those with at least 12m of
>  available follow-up

Allopurinol |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     21,126       68.95       68.95
        Yes |      9,512       31.05      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. **Generate variable for those who had allopurinol prescription within 12m of 
> diagnosis 
. gen allo_12m = 1 if time_to_allo<=365 & time_to_allo!=.
(23,467 missing values generated)

. recode allo_12m .=0
(allo_12m: 23467 changes made)

. lab var allo_12m "Allopurinol within 12 months of diagnosis"

. lab define allo_12m 0 "No" 1 "Yes", modify

. lab val allo_12m allo_12m

. tab allo_12m, missing

Allopurinol |
  within 12 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     23,467       64.06       64.06
        Yes |     13,168       35.94      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab allo_12m if has_12m_post_diag==1, missing //for those with at least 12m o
> f available follow-up 

Allopurinol |
  within 12 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     20,191       65.90       65.90
        Yes |     10,447       34.10      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. **Generate variable for time to first febuxostat prescription
. gen time_to_febux = first_febux_date-gout_code_date if first_febux_date!=. & 
> gout_code_date!=.
(29,382 missing values generated)

. 
. **Generate variable for those who had febuxostat prescription within 6m of di
> agnosis 
. gen febux_6m = 1 if time_to_febux<=180 & time_to_febux!=.
(32,638 missing values generated)

. recode febux_6m .=0
(febux_6m: 32638 changes made)

. lab var febux_6m "Febuxostat within 6 months of diagnosis"

. lab define febux_6m 0 "No" 1 "Yes", modify

. lab val febux_6m febux_6m

. tab febux_6m, missing

 Febuxostat |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     32,638       89.09       89.09
        Yes |      3,997       10.91      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab febux_6m if has_6m_post_diag==1, missing //for those with at least 6m of 
> available follow-up

 Febuxostat |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     30,058       89.39       89.39
        Yes |      3,567       10.61      100.00
------------+-----------------------------------
      Total |     33,625      100.00

. tab febux_6m if has_12m_post_diag==1, missing //for those with at least 12m o
> f available follow-up

 Febuxostat |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     27,477       89.68       89.68
        Yes |      3,161       10.32      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. **Generate variable for those who had febuxostat prescription within 12m of d
> iagnosis 
. gen febux_12m = 1 if time_to_febux<=365 & time_to_febux!=.
(32,296 missing values generated)

. recode febux_12m .=0
(febux_12m: 32296 changes made)

. lab var febux_12m "Febuxostat within 12 months of diagnosis"

. lab define febux_12m 0 "No" 1 "Yes", modify

. lab val febux_12m febux_12m

. tab febux_12m, missing

 Febuxostat |
  within 12 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     32,296       88.16       88.16
        Yes |      4,339       11.84      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab febux_12m if has_12m_post_diag==1, missing //for those with at least 12m 
> of available follow-up 

 Febuxostat |
  within 12 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     27,181       88.72       88.72
        Yes |      3,457       11.28      100.00
------------+-----------------------------------
      Total |     30,638      100.00

. 
. //Nb. can't tell dose - e.g. if allopurinol 100mg tablets issued, don't know 
> dose prescribed
. 
. *Proportion of patients with >6m/12m of registration and follow-up after firs
> t ULT prescription, assuming first prescription was within 6m of diagnosis
. gen has_6m_post_ult=1 if first_ult_date!=. & first_ult_date<(date("$end_date"
> , "DMY")-180) & has_6m_follow_up_ult==1 & ult_6m==1
(35,046 missing values generated)

. recode has_6m_post_ult .=0
(has_6m_post_ult: 35046 changes made)

. lab var has_6m_post_ult ">6m follow-up after ULT commenced"

. lab define has_6m_post_ult 0 "No" 1 "Yes", modify

. lab val has_6m_post_ult has_6m_post_ult

. tab has_6m_post_ult, missing 

        >6m |
  follow-up |
  after ULT |
  commenced |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     35,046       95.66       95.66
        Yes |      1,589        4.34      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab has_6m_post_ult if ult_6m==1, missing 

        >6m |
  follow-up |
  after ULT |
  commenced |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        213       11.82       11.82
        Yes |      1,589       88.18      100.00
------------+-----------------------------------
      Total |      1,802      100.00

. 
. gen has_12m_post_ult=1 if first_ult_date!=. & first_ult_date<(date("$end_date
> ", "DMY")-365) & has_12m_follow_up_ult==1 & ult_6m==1
(35,180 missing values generated)

. recode has_12m_post_ult .=0
(has_12m_post_ult: 35180 changes made)

. lab var has_12m_post_ult ">12m follow-up after ULT commenced"

. lab define has_12m_post_ult 0 "No" 1 "Yes", modify

. lab val has_12m_post_ult has_12m_post_ult

. tab has_12m_post_ult, missing 

       >12m |
  follow-up |
  after ULT |
  commenced |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     35,180       96.03       96.03
        Yes |      1,455        3.97      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab has_12m_post_ult if ult_12m==1, missing 

       >12m |
  follow-up |
  after ULT |
  commenced |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,919       56.88       56.88
        Yes |      1,455       43.12      100.00
------------+-----------------------------------
      Total |      3,374      100.00

. 
. **Number of ULT prescriptions issued in 6m after first script issued (Nb. dos
> es may be double counted if both 300mg and 100mg issued)
. tabstat ult_count_6m, stats (n mean sd p50 p25 p75)

    variable |         N      mean        sd       p50       p25       p75
-------------+------------------------------------------------------------
ult_count_6m |     36635  1.041163  1.753119         0         0         2
--------------------------------------------------------------------------

. tabstat ult_count_12m, stats (n mean sd p50 p25 p75)

    variable |         N      mean        sd       p50       p25       p75
-------------+------------------------------------------------------------
ult_coun~12m |     36635   1.02948  1.747475         0         0         2
--------------------------------------------------------------------------

. 
. *Serum urate measurements==================================================*/
. 
. *Set implausible urate values to missing (Note: zero changed to missing) and 
> remove urate dates if no measurements, and vice versa 
. **Depending on code, urate is in range 0.05 - 2 (mmol/L) or 50 - 2000 (microm
> ol/L). Need also to consider mg/dL
. forval i = 1/7  {
  2.                                                 codebook urate_val_`i' 
  3.                                                 summ urate_val_`i' if inra
> nge(urate_val_`i', 0.05, 2) // for mmol/L
  4.                                                 summ urate_val_`i' if inra
> nge(urate_val_`i', 50, 2000) // for micromol/L
  5.                                                 summ urate_val_`i' if urat
> e_val_`i'==. | urate_val_`i'==0 // missing or zero
  6.                                                 summ urate_val_`i' if ((!i
> nrange(urate_val_`i', 0.05, 2)) & (!inrange(urate_val_`i', 50, 2000)) & urate
> _val_`i'!=. & urate_val_`i'!=0) // not missing or zero or in above ranges    
>     
  7.                                                 replace urate_val_`i' = . 
> if ((!inrange(urate_val_`i', 0.05, 2)) & (!inrange(urate_val_`i', 50, 2000)))
>  // keep values that are mmol/L or micromol/L    
  8.                                                 codebook urate_val_`i'
  9.                                                 replace urate_val_`i' = . 
> if urate_date_`i' == . 
 10.                                                 replace urate_date_`i' = .
>  if urate_val_`i' == . 
 11.                                                 codebook urate_val_`i'
 12.                                                 replace urate_test_`i' = .
>  if urate_val_`i' == .
 13.                                                 recode urate_test_`i' .=0
 14.                                                 tab urate_test_`i', missin
> g
 15.                                                 replace urate_val_`i' = (u
> rate_val_`i'*1000) if inrange(urate_val_`i', 0.05, 2) //*1000 for those that 
> are in mmol/L
 16.                                                 codebook urate_val_`i'
 17. }

-------------------------------------------------------------------------------
urate_val_1                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [-28.04694,849.99359]        units:  1.000e-07
         unique values:  25,764                   missing .:  0/36,635

                  mean:   281.013
              std. dev:   200.707

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   342.331   435.977   507.179

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_1 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_1 |     25,794     399.117    100.3794   59.85682   849.9936

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_1 |     10,836           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_1 |          5    13.59692    25.55352  -28.04694   34.90214
(10,841 real changes made, 10,841 to missing)

-------------------------------------------------------------------------------
urate_val_1                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [59.856823,849.99359]        units:  1.000e-06
         unique values:  25,758                   missing .:  10,841/36,635

                  mean:   399.117
              std. dev:   100.379

           percentiles:        10%       25%       50%       75%       90%
                           270.699   330.388   399.501   466.655    527.81
(0 real changes made)
(5 real changes made, 5 to missing)

-------------------------------------------------------------------------------
urate_val_1                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [59.856823,849.99359]        units:  1.000e-06
         unique values:  25,758                   missing .:  10,841/36,635

                  mean:   399.117
              std. dev:   100.379

           percentiles:        10%       25%       50%       75%       90%
                           270.699   330.388   399.501   466.655    527.81
(10,841 real changes made, 10,841 to missing)
(urate_test_1: 10841 changes made)

urate_test_ |
          1 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,841       29.59       29.59
          1 |     25,794       70.41      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_1                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [59.856823,849.99359]        units:  1.000e-06
         unique values:  25,758                   missing .:  10,841/36,635

                  mean:   399.117
              std. dev:   100.379

           percentiles:        10%       25%       50%       75%       90%
                           270.699   330.388   399.501   466.655    527.81

-------------------------------------------------------------------------------
urate_val_2                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [-18.387707,827.22681]       units:  1.000e-06
         unique values:  25,583                   missing .:  0/36,635

                  mean:   279.833
              std. dev:   201.525

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   342.846   437.049   505.585

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_2 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_2 |     25,609    400.3156    99.32426   54.18295   827.2268

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_2 |     11,022           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_2 |          4   -2.890844    19.93337  -18.38771   26.38171
(11,026 real changes made, 11,026 to missing)

-------------------------------------------------------------------------------
urate_val_2                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [54.182949,827.22681]        units:  1.000e-06
         unique values:  25,578                   missing .:  11,026/36,635

                  mean:   400.316
              std. dev:   99.3243

           percentiles:        10%       25%       50%       75%       90%
                           273.033   332.603   399.976   467.191   527.292
(0 real changes made)
(4 real changes made, 4 to missing)

-------------------------------------------------------------------------------
urate_val_2                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [54.182949,827.22681]        units:  1.000e-06
         unique values:  25,578                   missing .:  11,026/36,635

                  mean:   400.316
              std. dev:   99.3243

           percentiles:        10%       25%       50%       75%       90%
                           273.033   332.603   399.976   467.191   527.292
(11,026 real changes made, 11,026 to missing)
(urate_test_2: 11026 changes made)

urate_test_ |
          2 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     11,026       30.10       30.10
          1 |     25,609       69.90      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_2                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [54.182949,827.22681]        units:  1.000e-06
         unique values:  25,578                   missing .:  11,026/36,635

                  mean:   400.316
              std. dev:   99.3243

           percentiles:        10%       25%       50%       75%       90%
                           273.033   332.603   399.976   467.191   527.292

-------------------------------------------------------------------------------
urate_val_3                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [-2.6753323,804.35779]       units:  1.000e-07
         unique values:  25,700                   missing .:  0/36,635

                  mean:   281.741
              std. dev:   201.435

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   346.345   437.908   507.062

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_3 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_3 |     25,721    401.2845     99.1083    57.4155   804.3578

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_3 |     10,907           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_3 |          7    19.34437    13.02301  -2.675332   31.78581
(10,914 real changes made, 10,914 to missing)

-------------------------------------------------------------------------------
urate_val_3                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [57.415504,804.35779]        units:  1.000e-06
         unique values:  25,692                   missing .:  10,914/36,635

                  mean:   401.284
              std. dev:   99.1083

           percentiles:        10%       25%       50%       75%       90%
                           273.381   335.467   401.428   467.056   528.185
(0 real changes made)
(7 real changes made, 7 to missing)

-------------------------------------------------------------------------------
urate_val_3                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [57.415504,804.35779]        units:  1.000e-06
         unique values:  25,692                   missing .:  10,914/36,635

                  mean:   401.284
              std. dev:   99.1083

           percentiles:        10%       25%       50%       75%       90%
                           273.381   335.467   401.428   467.056   528.185
(10,914 real changes made, 10,914 to missing)
(urate_test_3: 10914 changes made)

urate_test_ |
          3 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,914       29.79       29.79
          1 |     25,721       70.21      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_3                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [57.415504,804.35779]        units:  1.000e-06
         unique values:  25,692                   missing .:  10,914/36,635

                  mean:   401.284
              std. dev:   99.1083

           percentiles:        10%       25%       50%       75%       90%
                           273.381   335.467   401.428   467.056   528.185

-------------------------------------------------------------------------------
urate_val_4                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,822.33527]                units:  1.000e-06
         unique values:  25,523                   missing .:  0/36,635

                  mean:   279.201
              std. dev:   202.127

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   342.409   437.055   506.911

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_4 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_4 |     25,553    400.2841    100.5244   51.06039   822.3353

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_4 |     11,080           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_4 |          2    26.77152    9.768531   19.86413   33.67892
(11,082 real changes made, 11,082 to missing)

-------------------------------------------------------------------------------
urate_val_4                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.06039,822.33527]         units:  1.000e-06
         unique values:  25,520                   missing .:  11,082/36,635

                  mean:   400.284
              std. dev:   100.524

           percentiles:        10%       25%       50%       75%       90%
                           271.979   332.089   400.646   468.377   529.211
(0 real changes made)
(2 real changes made, 2 to missing)

-------------------------------------------------------------------------------
urate_val_4                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.06039,822.33527]         units:  1.000e-06
         unique values:  25,520                   missing .:  11,082/36,635

                  mean:   400.284
              std. dev:   100.524

           percentiles:        10%       25%       50%       75%       90%
                           271.979   332.089   400.646   468.377   529.211
(11,082 real changes made, 11,082 to missing)
(urate_test_4: 11082 changes made)

urate_test_ |
          4 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     11,082       30.25       30.25
          1 |     25,553       69.75      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_4                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.06039,822.33527]         units:  1.000e-06
         unique values:  25,520                   missing .:  11,082/36,635

                  mean:   400.284
              std. dev:   100.524

           percentiles:        10%       25%       50%       75%       90%
                           271.979   332.089   400.646   468.377   529.211

-------------------------------------------------------------------------------
urate_val_5                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,837.46198]                units:  1.000e-06
         unique values:  25,701                   missing .:  0/36,635

                  mean:   281.937
              std. dev:   201.927

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   346.466   438.828   508.555

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_5 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_5 |     25,711    401.7156      99.916   51.15179    837.462

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_5 |     10,918           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_5 |          6     43.0603    5.317568   33.05319   46.92175
(10,924 real changes made, 10,924 to missing)

-------------------------------------------------------------------------------
urate_val_5                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.151791,837.46198]        units:  1.000e-06
         unique values:  25,694                   missing .:  10,924/36,635

                  mean:   401.716
              std. dev:    99.916

           percentiles:        10%       25%       50%       75%       90%
                           273.415   334.762   401.741   469.427   529.368
(0 real changes made)
(6 real changes made, 6 to missing)

-------------------------------------------------------------------------------
urate_val_5                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.151791,837.46198]        units:  1.000e-06
         unique values:  25,694                   missing .:  10,924/36,635

                  mean:   401.716
              std. dev:    99.916

           percentiles:        10%       25%       50%       75%       90%
                           273.415   334.762   401.741   469.427   529.368
(10,924 real changes made, 10,924 to missing)
(urate_test_5: 10924 changes made)

urate_test_ |
          5 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,924       29.82       29.82
          1 |     25,711       70.18      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_5                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [51.151791,837.46198]        units:  1.000e-06
         unique values:  25,694                   missing .:  10,924/36,635

                  mean:   401.716
              std. dev:    99.916

           percentiles:        10%       25%       50%       75%       90%
                           273.415   334.762   401.741   469.427   529.368

-------------------------------------------------------------------------------
urate_val_6                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,815.14185]                units:  1.000e-07
         unique values:  25,565                   missing .:  0/36,635

                  mean:   278.886
              std. dev:    201.35

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   341.306   435.666   506.976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_6 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_6 |     25,585    399.3289     99.7764   52.38109   815.1418

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_6 |     11,045           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_6 |          5    30.02841    18.51169   3.354712   49.71564
(11,050 real changes made, 11,050 to missing)

-------------------------------------------------------------------------------
urate_val_6                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.381088,815.14185]        units:  1.000e-06
         unique values:  25,559                   missing .:  11,050/36,635

                  mean:   399.329
              std. dev:   99.7764

           percentiles:        10%       25%       50%       75%       90%
                           271.922    331.31   398.197   467.469   528.061
(0 real changes made)
(5 real changes made, 5 to missing)

-------------------------------------------------------------------------------
urate_val_6                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.381088,815.14185]        units:  1.000e-06
         unique values:  25,559                   missing .:  11,050/36,635

                  mean:   399.329
              std. dev:   99.7764

           percentiles:        10%       25%       50%       75%       90%
                           271.922    331.31   398.197   467.469   528.061
(11,050 real changes made, 11,050 to missing)
(urate_test_6: 11050 changes made)

urate_test_ |
          6 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     11,050       30.16       30.16
          1 |     25,585       69.84      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_6                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.381088,815.14185]        units:  1.000e-06
         unique values:  25,559                   missing .:  11,050/36,635

                  mean:   399.329
              std. dev:   99.7764

           percentiles:        10%       25%       50%       75%       90%
                           271.922    331.31   398.197   467.469   528.061

-------------------------------------------------------------------------------
urate_val_7                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [-26.612848,826.56628]       units:  1.000e-06
         unique values:  25,609                   missing .:  0/36,635

                  mean:   279.645
              std. dev:   201.314

           percentiles:        10%       25%       50%       75%       90%
                                 0         0   343.089   436.545   507.529

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_7 |          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_7 |     25,639    399.5758    99.93345   52.94552   826.5663

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_7 |     10,992           0           0          0          0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 urate_val_7 |          4    19.65347     31.5793  -26.61285   44.11183
(10,996 real changes made, 10,996 to missing)

-------------------------------------------------------------------------------
urate_val_7                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.945522,826.56628]        units:  1.000e-06
         unique values:  25,604                   missing .:  10,996/36,635

                  mean:   399.576
              std. dev:   99.9335

           percentiles:        10%       25%       50%       75%       90%
                           271.399   332.245   399.754   467.528   527.625
(0 real changes made)
(4 real changes made, 4 to missing)

-------------------------------------------------------------------------------
urate_val_7                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.945522,826.56628]        units:  1.000e-06
         unique values:  25,604                   missing .:  10,996/36,635

                  mean:   399.576
              std. dev:   99.9335

           percentiles:        10%       25%       50%       75%       90%
                           271.399   332.245   399.754   467.528   527.625
(10,996 real changes made, 10,996 to missing)
(urate_test_7: 10996 changes made)

urate_test_ |
          7 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,996       30.02       30.02
          1 |     25,639       69.98      100.00
------------+-----------------------------------
      Total |     36,635      100.00
(0 real changes made)

-------------------------------------------------------------------------------
urate_val_7                                                         (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [52.945522,826.56628]        units:  1.000e-06
         unique values:  25,604                   missing .:  10,996/36,635

                  mean:   399.576
              std. dev:   99.9335

           percentiles:        10%       25%       50%       75%       90%
                           271.399   332.245   399.754   467.528   527.625

. 
. reshape long urate_val_ urate_date_ urate_test_, i(patient_id) j(urate_order)
(note: j = 1 2 3 4 5 6 7)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    36635   ->  256445
Number of variables                 168   ->     151
j variable (7 values)                     ->   urate_order
xij variables:
urate_val_1 urate_val_2 ... urate_val_7   ->   urate_val_
urate_date_1 urate_date_2 ... urate_date_7->   urate_date_
urate_test_1 urate_test_2 ... urate_test_7->   urate_test_
-----------------------------------------------------------------------------

. 
. *Define baseline serum urate level as urate level closest to index diagnosis 
> date (must be within 6m before/after diagnosis and before ULT commencement)
. bys patient_id urate_date_ (urate_val_): gen n=_n //keeps only single urate t
> est from same day (i.e. delete duplicates), priotising ones !=.

. drop if n>1 
(43,373 observations deleted)

. drop n

. 
. gen test_after_ult=1 if urate_date_>first_ult_date & urate_date_!=. & first_u
> lt_date!=.
(185,958 missing values generated)

. replace test_after_ult=0 if urate_date_<=first_ult_date & urate_date_!=.
(152,372 real changes made)

. gen time_to_test = urate_date_-gout_code_date if urate_date_!=. & gout_code_d
> ate!=. //time to urate test from diagnosis date
(33,586 missing values generated)

. 
. gen abs_time_to_test = abs(time_to_test) if time_to_test!=. & time_to_test<=1
> 80 & time_to_test>=-180 & test_after_ult!=1 & urate_val_!=.
(193,613 missing values generated)

. bys patient_id (abs_time_to_test): gen n=_n 

. gen baseline_urate=urate_val_ if n==1 & abs_time_to_test!=. 
(197,585 missing values generated)

. lab var baseline_urate "Serum urate at baseline"

. gen had_baseline_urate = 1 if baseline_urate!=.
(197,585 missing values generated)

. lab var had_baseline_urate "Had serum urate performed at baseline"

. lab define had_baseline_urate 0 "No" 1 "Yes", modify

. lab val had_baseline_urate had_baseline_urate

. drop n

. by patient_id: replace baseline_urate = baseline_urate[_n-1] if missing(basel
> ine_urate)
(77,841 real changes made)

. by patient_id: replace had_baseline_urate = had_baseline_urate[_n-1] if missi
> ng(had_baseline_urate)
(77,841 real changes made)

. recode had_baseline_urate .=0
(had_baseline_urate: 119744 changes made)

. gen baseline_urate_below360=1 if baseline_urate<=360 & baseline_urate!=.
(180,906 missing values generated)

. lab var baseline_urate_below360 "Baseline serum urate <360 micromol/L"

. lab define baseline_urate_below360 0 "No" 1 "Yes", modify

. lab val baseline_urate_below360 baseline_urate_below360

. replace baseline_urate_below360=0 if baseline_urate>360 & baseline_urate!=.
(61,162 real changes made)

. drop abs_time_to_test

. 
. *Define proportion of patients who attained serum urate <360 within 6 months 
> of diagnosis, irrespective of ULT
. gen had_test_6m = 1 if (time_to_test>0 & time_to_test<=180) & urate_val_!=. /
> /any test done within 6 months of diagnosis
(203,197 missing values generated)

. bys patient_id (had_test_6m): gen n=_n if had_test_6m!=.
(203,197 missing values generated)

. by patient_id: egen count_urate_6m = max(n) //number of tests within 6m
(159757 missing values generated)

. recode count_urate_6m .=0 //includes those who didn't receive ULT
(count_urate_6m: 159757 changes made)

. lab var count_urate_6m "Number of urate levels within 6m of diagnosis"

. drop n

. sort patient_id had_test_6m

. by patient_id: replace had_test_6m = had_test_6m[_n-1] if missing(had_test_6m
> ) //any test done within 6 months of diagnosis
(43,440 real changes made)

. recode had_test_6m .=0 //includes those who didn't receive ULT
(had_test_6m: 159757 changes made)

. lab var had_test_6m "Urate test performed within 6 months of diagnosis"

. lab def had_test_6m 0 "No" 1 "Yes", modify

. lab val had_test_6m had_test_6m

. gen value_test_6m = urate_val_ if (time_to_test>0 & time_to_test<=180) & urat
> e_val_!=. //test values within 6 months of diagnosis
(203,197 missing values generated)

. bys patient_id (value_test_6m): gen n=_n if value_test_6m!=.
(203,197 missing values generated)

. gen lowest_urate_6m = value_test_6m if n==1 //lowest urate value within 6m of
>  diagnosis
(204,261 missing values generated)

. lab var lowest_urate_6m "Lowest urate value within 6m of diagnosis"

. sort patient_id (lowest_urate_6m)

. by patient_id: replace lowest_urate_6m = lowest_urate_6m[_n-1] if missing(low
> est_urate_6m)
(44,504 real changes made)

. drop n value_test_6m

. gen urate_below360_6m = 1 if lowest_urate_6m<=360 & lowest_urate_6m!=.
(193,342 missing values generated)

. lab var urate_below360_6m  "Urate <360 micromol/L within 6m of diagnosis"

. lab def urate_below360_6m 0 "No" 1 "Yes", modify

. lab val urate_below360_6m urate_below360_6m

. recode urate_below360_6m .=0 //includes those who didn't have a test within 6
> m
(urate_below360_6m: 193342 changes made)

. 
. *Define proportion of patients who attained serum urate <360 within 12 months
>  of diagnosis, irrespective of ULT
. gen had_test_12m = 1 if (time_to_test>0 & time_to_test<=365) & urate_val_!=. 
> //any test done within 12 months of diagnosis
(193,266 missing values generated)

. bys patient_id (had_test_12m): gen n=_n if had_test_12m!=.
(193,266 missing values generated)

. by patient_id: egen count_urate_12m = max(n) //number of tests within 12m
(118204 missing values generated)

. recode count_urate_12m .=0 //includes those who didn't receive ULT
(count_urate_12m: 118204 changes made)

. lab var count_urate_12m "Number of urate levels within 12m of diagnosis"

. drop n

. sort patient_id had_test_12m

. by patient_id: replace had_test_12m = had_test_12m[_n-1] if missing(had_test_
> 12m) //any test done within 12 months of diagnosis
(75,062 real changes made)

. recode had_test_12m .=0 //includes those who didn't receive ULT
(had_test_12m: 118204 changes made)

. lab var had_test_12m "Urate test performed within 12 months of diagnosis"

. lab def had_test_12m 0 "No" 1 "Yes", modify

. lab val had_test_12m had_test_12m

. gen value_test_12m = urate_val_ if (time_to_test>0 & time_to_test<=365) & ura
> te_val_!=. //test values within 12 months of diagnosis
(193,266 missing values generated)

. bys patient_id (value_test_12m): gen n=_n if value_test_12m!=.
(193,266 missing values generated)

. gen lowest_urate_12m = value_test_12m if n==1 //lowest urate value within 12m
>  of diagnosis
(197,321 missing values generated)

. lab var lowest_urate_12m "Lowest urate value within 12m of diagnosis"

. sort patient_id (lowest_urate_12m)

. by patient_id: replace lowest_urate_12m = lowest_urate_12m[_n-1] if missing(l
> owest_urate_12m)
(79,117 real changes made)

. drop n value_test_12m

. gen urate_below360_12m = 1 if lowest_urate_12m<=360 & lowest_urate_12m!=.
(175,064 missing values generated)

. lab var urate_below360_12m  "Urate <360 micromol/L within 12m of diagnosis"

. lab def urate_below360_12m 0 "No" 1 "Yes", modify

. lab val urate_below360_12m urate_below360_12m

. recode urate_below360_12m .=0 //includes those who didn't have a test within 
> 12m
(urate_below360_12m: 175064 changes made)

. 
. drop time_to_test

. 
. *Define proportion of patients commenced on ULT within 6 months of diagnosis 
> who attained serum urate <360 within 6 months of ULT commencement 
. gen time_to_test_ult_6m = urate_date_- first_ult_date if urate_date_!=. & fir
> st_ult_date!=. & test_after_ult==1
(185,958 missing values generated)

. gen had_test_ult_6m = 1 if time_to_test_ult_6m<=180 & time_to_test_ult_6m!=. 
> & urate_val_!=. //any test done within 6 months of ULT
(208,439 missing values generated)

. bys patient_id (had_test_ult_6m): gen n=_n if had_test_ult_6m!=.
(208,439 missing values generated)

. by patient_id: egen count_urate_ult_6m = max(n) //number of tests within 6m o
> f ULT
(187963 missing values generated)

. recode count_urate_ult_6m .=0 //includes those who didn't receive ULT
(count_urate_ult_6m: 187963 changes made)

. lab var count_urate_ult_6m "Number of urate levels within 6m of ULT initiatio
> n"

. drop n

. sort patient_id had_test_ult_6m

. by patient_id: replace had_test_ult_6m = had_test_ult_6m[_n-1] if missing(had
> _test_ult_6m) //any test done within 6 months of ULT
(20,476 real changes made)

. recode had_test_ult_6m .=0 //includes those who didn't receive ULT
(had_test_ult_6m: 187963 changes made)

. lab var had_test_ult_6m "Urate test performed within 6 months of ULT"

. lab def had_test_ult_6m 0 "No" 1 "Yes", modify

. lab val had_test_ult_6m had_test_ult_6m

. gen value_test_ult_6m = urate_val_ if time_to_test_ult_6m<=180 & time_to_test
> _ult_6m!=. & urate_val_!=. //test values within 6 months of ULT
(208,439 missing values generated)

. bys patient_id (value_test_ult_6m): gen n=_n if value_test_ult_6m!=.
(208,439 missing values generated)

. gen lowest_urate_ult_6m = value_test_ult_6m if n==1 //lowest urate value with
> in 6m of ULT
(208,922 missing values generated)

. lab var lowest_urate_ult_6m "Lowest urate value within 6m of ULT initiation"

. sort patient_id (lowest_urate_ult_6m)

. by patient_id: replace lowest_urate_ult_6m = lowest_urate_ult_6m[_n-1] if mis
> sing(lowest_urate_ult_6m)
(20,959 real changes made)

. drop n value_test_ult_6m

. gen urate_below360_ult_6m = 1 if lowest_urate_ult_6m<=360 & lowest_urate_ult_
> 6m!=.
(203,710 missing values generated)

. lab var urate_below360_ult_6m  "Urate <360 micromol/L within 6m of ULT initia
> tion"

. lab def urate_below360_ult_6m 0 "No" 1 "Yes", modify

. lab val urate_below360_ult_6m urate_below360_ult_6m

. recode urate_below360_ult_6m .=0 //includes those who didn't receive ULT or d
> idn't have a test within 6m
(urate_below360_ult_6m: 203710 changes made)

. drop time_to_test_ult_6m

. 
. *Define proportion of patients commenced on ULT within 6 months (important) o
> f diagnosis who attained serum urate <360 within 12 months of ULT commencemen
> t
. gen time_to_test_ult_12m = urate_date_- first_ult_date if urate_date_!=. & fi
> rst_ult_date!=. & test_after_ult==1
(185,958 missing values generated)

. gen had_test_ult_12m = 1 if time_to_test_ult_12m<=365 & time_to_test_ult_12m!
> =. & urate_val_!=. //test done within 12 months of ULT
(204,334 missing values generated)

. bys patient_id (had_test_ult_12m): gen n=_n if had_test_ult_12m!=.
(204,334 missing values generated)

. by patient_id: egen count_urate_ult_12m = max(n) //number of tests within 12m
>  of ULT
(170862 missing values generated)

. recode count_urate_ult_12m .=0 //includes those who didn't receive ULT
(count_urate_ult_12m: 170862 changes made)

. lab var count_urate_ult_12m "Number of urate levels within 12m of ULT initiat
> ion"

. drop n

. sort patient_id had_test_ult_12m

. by patient_id: replace had_test_ult_12m = had_test_ult_12m[_n-1] if missing(h
> ad_test_ult_12m)
(33,472 real changes made)

. recode had_test_ult_12m .=0 //includes those who didn't receive ULT
(had_test_ult_12m: 170862 changes made)

. lab var had_test_ult_12m "Urate test performed within 12 months of ULT"

. lab def had_test_ult_12m 0 "No" 1 "Yes", modify

. lab val had_test_ult_12m had_test_ult_12m

. gen value_test_ult_12m = urate_val_ if time_to_test_ult_12m<=365 & time_to_te
> st_ult_12m!=. & urate_val_!=. //test values within 12 months of ULT
(204,334 missing values generated)

. bys patient_id (value_test_ult_12m): gen n=_n if value_test_ult_12m!=.
(204,334 missing values generated)

. gen lowest_urate_ult_12m = value_test_ult_12m if n==1 //lowest urate value wi
> thin 12m of ULT
(206,069 missing values generated)

. lab var lowest_urate_ult_12m "Lowest urate value within 12m of ULT initiation
> "

. sort patient_id (lowest_urate_ult_12m)

. by patient_id: replace lowest_urate_ult_12m = lowest_urate_ult_12m[_n-1] if m
> issing(lowest_urate_ult_12m)
(35,207 real changes made)

. drop n value_test_ult_12m

. gen urate_below360_ult_12m = 1 if lowest_urate_ult_12m<=360 & lowest_urate_ul
> t_12m!=.
(195,715 missing values generated)

. recode urate_below360_ult_12m .=0 //includes those who didn't receive ULT or 
> didn't have a test within 12m
(urate_below360_ult_12m: 195715 changes made)

. lab var urate_below360_ult_12m  "Urate <360 micromol/L within 12m of ULT init
> iation"

. lab def urate_below360_ult_12m 0 "No" 1 "Yes", modify

. lab val urate_below360_ult_12m urate_below360_ult_12m

. drop time_to_test_ult_12m

. 
. drop test_after_ult             

. reshape wide urate_val_ urate_date_ urate_test_, i(patient_id) j(urate_order)
(note: j = 1 2 3 4 5 6 7)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   213072   ->   36635
Number of variables                 170   ->     187
j variable (7 values)       urate_order   ->   (dropped)
xij variables:
                             urate_val_   ->   urate_val_1 urate_val_2 ... urat
> e_val_7
                            urate_date_   ->   urate_date_1 urate_date_2 ... ur
> ate_date_7
                            urate_test_   ->   urate_test_1 urate_test_2 ... ur
> ate_test_7
-----------------------------------------------------------------------------

. 
. tabstat baseline_urate, stats(n mean p50 p25 p75)

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
baseline_u~e |     15487  400.0174  400.9828  331.8114  467.9146
----------------------------------------------------------------

. tab baseline_urate_below360, missing

   Baseline |
serum urate |
       <360 |
 micromol/L |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     10,149       27.70       27.70
        Yes |      5,338       14.57       42.27
          . |     21,148       57.73      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. tabstat lowest_urate_ult_6m, stats(n mean p50 p25 p75)

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
lowest_~t_6m |      4150  394.3221  393.7176  327.6715  462.1075
----------------------------------------------------------------

. tab urate_below360_ult_6m if has_6m_post_ult==1, missing //for those who rece
> ived ULT within 6m and had >6m of follow-up

 Urate <360 |
 micromol/L |
  within 6m |
     of ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,452       91.38       91.38
        Yes |        137        8.62      100.00
------------+-----------------------------------
      Total |      1,589      100.00

. tab urate_below360_ult_6m if has_6m_post_ult==1 & had_test_ult_6m==1, missing
>  //for those who received ULT within 6m, had >6m of follow-up, and had a test
>  performed within 6m of ULT

 Urate <360 |
 micromol/L |
  within 6m |
     of ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        230       62.67       62.67
        Yes |        137       37.33      100.00
------------+-----------------------------------
      Total |        367      100.00

. tabstat count_urate_ult_6m if has_6m_post_ult==1, stats(n mean p50 p25 p75) /
> /number of tests performed within 6m of ULT initiation

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
count_u~t_6m |      1589   .254248         0         0         0
----------------------------------------------------------------

. gen two_urate_ult_6m=1 if count_urate_ult_6m>=2 & count_urate_ult_6m!=. //two
>  or more urate tests performed within 6m of ULT initiation
(36,181 missing values generated)

. recode two_urate_ult_6m .=0 //includes those who didn't receive ULT
(two_urate_ult_6m: 36181 changes made)

. lab var two_urate_ult_6m "At least 2 urate tests performed within 6 months of
>  ULT initiation"

. lab def two_urate_ult_6m 0 "No" 1 "Yes", modify

. lab val two_urate_ult_6m two_urate_ult_6m

. tab two_urate_ult_6m if has_6m_post_ult==1, missing 

 At least 2 |
urate tests |
  performed |
   within 6 |
  months of |
        ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,555       97.86       97.86
        Yes |         34        2.14      100.00
------------+-----------------------------------
      Total |      1,589      100.00

. 
. tabstat lowest_urate_ult_12m, stats(n mean p50 p25 p75)

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
lowest~t_12m |      7003  386.7075  384.4149  318.6307  454.8557
----------------------------------------------------------------

. tab urate_below360_ult_12m if has_12m_post_ult==1, missing //for those who re
> ceived ULT within 6m and had >12m of follow-up

 Urate <360 |
 micromol/L |
 within 12m |
     of ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,195       82.13       82.13
        Yes |        260       17.87      100.00
------------+-----------------------------------
      Total |      1,455      100.00

. tab urate_below360_ult_12m if has_12m_post_ult==1 & had_test_ult_12m==1, miss
> ing //for those who received ULT within 6m, had >12m of follow-up, and had a 
> test performed within 12m of ULT

 Urate <360 |
 micromol/L |
 within 12m |
     of ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |        366       58.47       58.47
        Yes |        260       41.53      100.00
------------+-----------------------------------
      Total |        626      100.00

. tabstat count_urate_ult_12m if has_12m_post_ult==1, stats(n mean p50 p25 p75)
>  //number of tests performed within 12m of ULT initiation

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
count_~t_12m |      1455  .5347079         0         0         1
----------------------------------------------------------------

. gen two_urate_ult_12m=1 if count_urate_ult_12m>=2 & count_urate_ult_12m!=. //
> two or more urate tests performed within 12m of ULT initiation
(35,117 missing values generated)

. recode two_urate_ult_12m .=0 //includes those who didn't receive ULT
(two_urate_ult_12m: 35117 changes made)

. lab var two_urate_ult_12m "At least 2 urate tests performed within 6 months o
> f ULT initiation"

. lab def two_urate_ult_12m 0 "No" 1 "Yes", modify

. lab val two_urate_ult_12m two_urate_ult_12m

. tab two_urate_ult_12m if has_12m_post_ult==1, missing 

 At least 2 |
urate tests |
  performed |
   within 6 |
  months of |
        ULT |
 initiation |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      1,326       91.13       91.13
        Yes |        129        8.87      100.00
------------+-----------------------------------
      Total |      1,455      100.00

. 
. *Define flare================================================================
> ==============*/
. 
. *Define flare (adapted from https://jamanetwork.com/journals/jama/fullarticle
> /2794763): 1) presence of a non-index diagnostic code for gout exacerbation; 
> 2) non-index admission with primary gout diagnostic code; 3) non-index ED att
> endance with primary gout diagnostic code; 4) any non-index gout diagnostic c
> ode AND prescription for a flare treatment on same day as that code; all with
> in 6m of index diagnostic code. Exclude events that occur within 14 days of o
> ne another
. 
. **Non-index admission with primary gout diagnostic code
. reshape long gout_admission_date_ gout_admission_, i(patient_id) j(admission_
> order)
(note: j = 1 2 3)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    36635   ->  109905
Number of variables                 189   ->     186
j variable (3 values)                     ->   admission_order
xij variables:
gout_admission_date_1 gout_admission_date_2 gout_admission_date_3->gout_admissi
> on_date_
gout_admission_1 gout_admission_2 gout_admission_3->gout_admission_
-----------------------------------------------------------------------------

. preserve

. gen flare_overall_date=gout_admission_date_ if ((gout_admission_date_<(gout_c
> ode_date+180)) & (gout_admission_date_>(gout_code_date+14))) & gout_admission
> _date_!=. //save a list of admission dates within 6m of diagnosis, but not wi
> thin first 14 days of diagnosis
(108,305 missing values generated)

. format %td flare_overall_date

. keep patient_id admission_order flare_overall_date

. save "$projectdir/output/data/admission_dates_long.dta", replace
file /workspace/output/data/admission_dates_long.dta saved

. restore

. bys patient_id (gout_admission_date_): gen n=_n

. replace gout_admission_=0 if (gout_admission_date_-14<gout_admission_date_[_n
> -1]) & gout_admission_date_!=. & gout_admission_date_[_n-1]!=. //remove admis
> sions within 14 days of one another
(635 real changes made)

. replace gout_admission_date_=. if (gout_admission_date_-14<gout_admission_dat
> e_[_n-1]) & gout_admission_date_!=. & gout_admission_date_[_n-1]!=.
(623 real changes made, 623 to missing)

. drop n

. bys patient_id (gout_admission_date_): gen n=_n

. replace gout_admission_=0 if (gout_admission_date_-14<gout_admission_date_[_n
> -1]) & gout_admission_date_!=. & gout_admission_date_[_n-1]!=. //remove admis
> sions within 14 days of one another (repeat this)
(129 real changes made)

. replace gout_admission_date_=. if (gout_admission_date_-14<gout_admission_dat
> e_[_n-1]) & gout_admission_date_!=. & gout_admission_date_[_n-1]!=.
(130 real changes made, 130 to missing)

. drop n

. reshape wide gout_admission_date_ gout_admission_, i(patient_id) j(admission_
> order)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   109905   ->   36635
Number of variables                 186   ->     189
j variable (3 values)   admission_order   ->   (dropped)
xij variables:
                   gout_admission_date_   ->   gout_admission_date_1 gout_admis
> sion_date_2 gout_admission_date_3
                        gout_admission_   ->   gout_admission_1 gout_admission_
> 2 gout_admission_3
-----------------------------------------------------------------------------

. 
. **Non-index ED attendance with primary gout diagnostic code
. reshape long gout_emerg_date_ gout_emerg_, i(patient_id) j(emerg_order)
(note: j = 1 2 3)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    36635   ->  109905
Number of variables                 189   ->     186
j variable (3 values)                     ->   emerg_order
xij variables:
gout_emerg_date_1 gout_emerg_date_2 gout_emerg_date_3->gout_emerg_date_
 gout_emerg_1 gout_emerg_2 gout_emerg_3   ->   gout_emerg_
-----------------------------------------------------------------------------

. preserve

. gen flare_overall_date=gout_emerg_date_ if ((gout_emerg_date_<(gout_code_date
> +180)) & (gout_emerg_date_>(gout_code_date+14))) & gout_emerg_date_!=. //save
>  a list of ED dates within 6m of diagnosis, but not within first 14 days of d
> iagnosis
(108,216 missing values generated)

. format %td flare_overall_date

. keep patient_id emerg_order flare_overall_date

. save "$projectdir/output/data/emerg_dates_long.dta", replace
file /workspace/output/data/emerg_dates_long.dta saved

. restore

. bys patient_id (gout_emerg_date_): gen n=_n

. replace gout_emerg_=0 if (gout_emerg_date_-14<gout_emerg_date_[_n-1]) & gout_
> emerg_date_!=. & gout_emerg_date_[_n-1]!=. //remove emergs within 14 days of 
> one another
(591 real changes made)

. replace gout_emerg_date_=. if (gout_emerg_date_-14<gout_emerg_date_[_n-1]) & 
> gout_emerg_date_!=. & gout_emerg_date_[_n-1]!=.
(586 real changes made, 586 to missing)

. drop n

. bys patient_id (gout_emerg_date_): gen n=_n

. replace gout_emerg_=0 if (gout_emerg_date_-14<gout_emerg_date_[_n-1]) & gout_
> emerg_date_!=. & gout_emerg_date_[_n-1]!=. //remove emergs within 14 days of 
> one another (repeat this)
(127 real changes made)

. replace gout_emerg_date_=. if (gout_emerg_date_-14<gout_emerg_date_[_n-1]) & 
> gout_emerg_date_!=. & gout_emerg_date_[_n-1]!=.
(128 real changes made, 128 to missing)

. drop n

. reshape wide gout_emerg_date_ gout_emerg_, i(patient_id) j(emerg_order)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   109905   ->   36635
Number of variables                 186   ->     189
j variable (3 values)       emerg_order   ->   (dropped)
xij variables:
                       gout_emerg_date_   ->   gout_emerg_date_1 gout_emerg_dat
> e_2 gout_emerg_date_3
                            gout_emerg_   ->   gout_emerg_1 gout_emerg_2 gout_e
> merg_3
-----------------------------------------------------------------------------

. 
. **Any non-index gout diagnostic code AND prescription for a flare treatment o
> n same day as that code;
. reshape long gout_code_any_ gout_code_any_date_, i(patient_id) j(code_order)
(note: j = 1 2 3)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    36635   ->  109905
Number of variables                 189   ->     186
j variable (3 values)                     ->   code_order
xij variables:
gout_code_any_1 gout_code_any_2 gout_code_any_3->gout_code_any_
gout_code_any_date_1 gout_code_any_date_2 gout_code_any_date_3->gout_code_any_d
> ate_
-----------------------------------------------------------------------------

. gen code_and_tx_date_=.
(109,905 missing values generated)

. format %td code_and_tx_date_

. forval i = 1/6  {
  2. replace code_and_tx_date_=gout_code_any_date_ if gout_code_any_date_==flar
> e_treatment_date_`i' & gout_code_any_date_!=. & flare_treatment_date_`i'!=.
  3. }
(4 real changes made)
(2 real changes made)
(7 real changes made)
(7 real changes made)
(9 real changes made)
(9 real changes made)

. preserve

. gen flare_overall_date=code_and_tx_date_ if ((code_and_tx_date_<(gout_code_da
> te+180)) & (code_and_tx_date_>(gout_code_date+14))) & code_and_tx_date_!=. //
> save a list of code/Tx dates within 6m of diagnosis
(109,902 missing values generated)

. format %td flare_overall_date

. keep patient_id code_order flare_overall_date

. save "$projectdir/output/data/code_tx_dates_long.dta", replace
file /workspace/output/data/code_tx_dates_long.dta saved

. restore

. bys patient_id (code_and_tx_date_): gen n=_n

. replace code_and_tx_date_=. if (code_and_tx_date_-14<code_and_tx_date_[_n-1])
>  & code_and_tx_date_!=. & code_and_tx_date_[_n-1]!=. //remove flares within 1
> 4 days of one another
(0 real changes made)

. drop n

. bys patient_id (code_and_tx_date_): gen n=_n

. replace code_and_tx_date_=. if (code_and_tx_date_-14<code_and_tx_date_[_n-1])
>  & code_and_tx_date_!=. & code_and_tx_date_[_n-1]!=. //remove flares within 1
> 4 days of one another (repeat this)
(0 real changes made)

. drop n

. reshape wide gout_code_any_ gout_code_any_date_ code_and_tx_date_, i(patient_
> id) j(code_order)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   109905   ->   36635
Number of variables                 187   ->     192
j variable (3 values)        code_order   ->   (dropped)
xij variables:
                         gout_code_any_   ->   gout_code_any_1 gout_code_any_2 
> gout_code_any_3
                    gout_code_any_date_   ->   gout_code_any_date_1 gout_code_a
> ny_date_2 gout_code_any_date_3
                      code_and_tx_date_   ->   code_and_tx_date_1 code_and_tx_d
> ate_2 code_and_tx_date_3
-----------------------------------------------------------------------------

. 
. **Presence of a non-index diagnostic code for gout exacerbation
. reshape long gout_flare_date_ gout_flare_, i(patient_id) j(flare_order)
(note: j = 1 2 3)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    36635   ->  109905
Number of variables                 192   ->     189
j variable (3 values)                     ->   flare_order
xij variables:
gout_flare_date_1 gout_flare_date_2 gout_flare_date_3->gout_flare_date_
 gout_flare_1 gout_flare_2 gout_flare_3   ->   gout_flare_
-----------------------------------------------------------------------------

. preserve

. gen flare_overall_date=gout_flare_date_ if ((gout_flare_date_<(gout_code_date
> +180)) & (gout_flare_date_>(gout_code_date+14))) & gout_flare_date_!=. //save
>  a list of code/Tx dates within 6m of diagnosis, but not within first 14 days
>  of diagnosis
(107,775 missing values generated)

. format %td flare_overall_date

. keep patient_id flare_order flare_overall_date

. save "$projectdir/output/data/flare_dates_long.dta", replace
file /workspace/output/data/flare_dates_long.dta saved

. append using "$projectdir/output/data/code_tx_dates_long.dta" //append all ot
> her flares/admissions/ED

. append using "$projectdir/output/data/emerg_dates_long.dta"

. append using "$projectdir/output/data/admission_dates_long.dta"

. bys patient_id (flare_overall_date): gen n=_n 

. replace flare_overall_date=. if (flare_overall_date-14<flare_overall_date[_n-
> 1]) & flare_overall_date!=. & flare_overall_date[_n-1]!=. //remove flares wit
> hin 14 days of one another
(48 real changes made, 48 to missing)

. drop n

. bys patient_id (flare_overall_date): gen n=_n 

. replace flare_overall_date=. if (flare_overall_date-14<flare_overall_date[_n-
> 1]) & flare_overall_date!=. & flare_overall_date[_n-1]!=. //remove flares wit
> hin 14 days of one another (repeat this)
(0 real changes made)

. drop n

. bys patient_id (flare_overall_date): gen n=_n 

. replace flare_overall_date=. if (flare_overall_date-14<flare_overall_date[_n-
> 1]) & flare_overall_date!=. & flare_overall_date[_n-1]!=. //remove flares wit
> hin 14 days of one another (repeat this)
(0 real changes made)

. drop n

. bys patient_id (flare_overall_date): gen n=_n 

. replace flare_overall_date=. if (flare_overall_date-14<flare_overall_date[_n-
> 1]) & flare_overall_date!=. & flare_overall_date[_n-1]!=. //remove flares wit
> hin 14 days of one another (repeat this)
(0 real changes made)

. drop n

. bys patient_id (flare_overall_date): gen n=_n if flare_overall_date!=.
(434,246 missing values generated)

. by patient_id: egen flare_count=max(n) //count of flares/admissions/ED within
>  6 months 
(378612 missing values generated)

. lab var flare_count "Number of gout flares in 6 months after diagnosis"

. drop n

. bys patient_id (flare_overall_date): gen n=_n 

. keep if n==1
(402,985 observations deleted)

. keep patient_id flare_count

. save "$projectdir/output/data/flare_count.dta", replace
file /workspace/output/data/flare_count.dta saved

. restore

. bys patient_id (gout_flare_date_): gen n=_n

. replace gout_flare_=0 if (gout_flare_date_-14<gout_flare_date_[_n-1]) & gout_
> flare_date_!=. & gout_flare_date_[_n-1]!=. //remove flares within 14 days of 
> one another
(1,628 real changes made)

. replace gout_flare_date_=. if (gout_flare_date_-14<gout_flare_date_[_n-1]) & 
> gout_flare_date_!=. & gout_flare_date_[_n-1]!=.
(1,606 real changes made, 1,606 to missing)

. drop n

. bys patient_id (gout_flare_date_): gen n=_n

. replace gout_flare_=0 if (gout_flare_date_-14<gout_flare_date_[_n-1]) & gout_
> flare_date_!=. & gout_flare_date_[_n-1]!=. //remove flares within 14 days of 
> one another (repeat this)
(466 real changes made)

. replace gout_flare_date_=. if (gout_flare_date_-14<gout_flare_date_[_n-1]) & 
> gout_flare_date_!=. & gout_flare_date_[_n-1]!=.
(472 real changes made, 472 to missing)

. drop n

. reshape wide gout_flare_date_ gout_flare_, i(patient_id) j(flare_order)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                   109905   ->   36635
Number of variables                 189   ->     192
j variable (3 values)       flare_order   ->   (dropped)
xij variables:
                       gout_flare_date_   ->   gout_flare_date_1 gout_flare_dat
> e_2 gout_flare_date_3
                            gout_flare_   ->   gout_flare_1 gout_flare_2 gout_f
> lare_3
-----------------------------------------------------------------------------

. 
. **Now merge flare count in with original dataset
. merge 1:1 patient_id using "$projectdir/output/data/flare_count.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            36,635  (_merge==3)
    -----------------------------------------

. drop _merge

. recode flare_count .=0
(flare_count: 31551 changes made)

. lab var flare_count "Number of flares after diagnosis"

. tabstat flare_count, stats (n mean p50 p25 p75)

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
 flare_count |     36635  .1466903         0         0         0
----------------------------------------------------------------

. gen multiple_flares = 1 if flare_count>=1 & flare_count!=. //define multiple 
> flares as one or more additional flare within first 6 months of diagnosis
(31,551 missing values generated)

. recode multiple_flares .=0
(multiple_flares: 31551 changes made)

. lab var multiple_flares "At least one additional flare within 6 months of dia
> gnosis"

. lab def multiple_flares 0 "No" 1 "Yes", modify

. lab val multiple_flares multiple_flares

. tab multiple_flares     

   At least |
        one |
 additional |
      flare |
   within 6 |
  months of |
  diagnosis |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |     31,551       86.12       86.12
        Yes |      5,084       13.88      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. 
. *Define high-risk patients for ULT===========================================
> ================*/
. gen high_risk = 1 if tophi==1 | ckd==1 | diuretic==1 | multiple_flares==1
(9,065 missing values generated)

. recode high_risk .=0    
(high_risk: 9065 changes made)

. lab var high_risk "Presence of risk factors"

. lab def high_risk 0 "No" 1 "Yes", modify

. lab val high_risk high_risk

. 
. **Time to first ULT; prescription must be within 6 months of diagnosis ======
> ====================*/
. tabstat time_to_ult, stats (n mean p50 p25 p75) //without any time restrictio
> n

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
 time_to_ult |     18093  1165.609      1078       503      1751
----------------------------------------------------------------

. gen time_to_ult_6m=(first_ult_date-gout_code_date) if first_ult_date!=. & (fi
> rst_ult_date<=gout_code_date+180)
(34,833 missing values generated)

. tabstat time_to_ult_6m, stats (n mean p50 p25 p75) //with 6m time restriction

    variable |         N      mean       p50       p25       p75
-------------+--------------------------------------------------
time_to_u~6m |      1802  78.65372        76        21       132
----------------------------------------------------------------

. 
. **ULT time categories
. gen ult_time=1 if time_to_ult_6m<=90 & time_to_ult_6m!=. 
(35,626 missing values generated)

. replace ult_time=2 if time_to_ult_6m>90 & time_to_ult_6m<=180 & time_to_ult_6
> m!=.
(793 real changes made)

. replace ult_time=3 if time_to_ult_6m>180 | time_to_ult_6m==.
(34,833 real changes made)

. lab define ult_time 1 "Within 3 months" 2 "3-6 months" 3 "No prescription wit
> hin 6 months", modify

. lab val ult_time ult_time

. lab var ult_time "ULT initiation, overall" 

. 
. /*/Need to amend below if needed
> gen ult_time_19=ult_time if diagnosis_year==1
> recode ult_time_19 .=4
> gen ult_time_20=ult_time if diagnosis_year==2
> recode ult_time_20 .=4
> gen ult_time_21=ult_time if diagnosis_year==3
> recode ult_time_21 .=4
> gen ult_time_22=ult_time if diagnosis_year==4
> recode ult_time_22 .=4
> 
> 
> gen gp_appt_cat_19=gp_appt_cat if appt_year==1
> gen gp_appt_cat_20=gp_appt_cat if appt_year==2
> gen gp_appt_cat_21=gp_appt_cat if appt_year==3
> gen gp_appt_cat_22=gp_appt_cat if appt_year==4
> lab define gp_appt_cat_19 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More th
> an 6 weeks", modify
> lab val gp_appt_cat_19 gp_appt_cat_19
> lab var gp_appt_cat_19 "Time to rheumatology assessment, Apr 2019-2020"
> lab define gp_appt_cat_20 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More th
> an 6 weeks", modify
> lab val gp_appt_cat_20 gp_appt_cat_20
> lab var gp_appt_cat_20 "Time to rheumatology assessment, Apr 2020-2021"
> lab define gp_appt_cat_21 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More th
> an 6 weeks", modify
> lab val gp_appt_cat_21 gp_appt_cat_21
> lab var gp_appt_cat_21 "Time to rheumatology assessment, Apr 2021-2022"
> lab define gp_appt_cat_22 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More th
> an 6 weeks", modify
> lab val gp_appt_cat_22 gp_appt_cat_22
> lab var gp_appt_cat_22 "Time to rheumatology assessment, Apr 2022-2023"
> 
> gen gp_appt_3w=1 if time_gp_rheum_appt<=21 & time_gp_rheum_appt!=. 
> replace gp_appt_3w=2 if time_gp_rheum_appt>21 & time_gp_rheum_appt!=.
> lab define gp_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify
> lab val gp_appt_3w gp_appt_3w
> lab var gp_appt_3w "Time to rheumatology assessment, overall"
> tab gp_appt_3w, missing
> 
> gen ref_appt_cat=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
> replace ref_appt_cat=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt<=42 & 
> time_ref_rheum_appt!=. & ref_appt_cat==.
> replace ref_appt_cat=3 if time_ref_rheum_appt>42 & time_ref_rheum_appt!=. & r
> ef_appt_cat==.
> lab define ref_appt_cat 1 "Within 3 weeks" 2 "Between 3-6 weeks" 3 "More than
>  6 weeks", modify
> lab val ref_appt_cat ref_appt_cat
> lab var ref_appt_cat "Time to rheumatology assessment"
> tab ref_appt_cat, missing
> 
> gen ref_appt_3w=1 if time_ref_rheum_appt<=21 & time_ref_rheum_appt!=. 
> replace ref_appt_3w=2 if time_ref_rheum_appt>21 & time_ref_rheum_appt!=.
> lab define ref_appt_3w 1 "Within 3 weeks" 2 "More than 3 weeks", modify
> lab val ref_appt_3w ref_appt_3w
> lab var ref_appt_3w "Time to rheumatology assessment"
> tab ref_appt_3w, missing
> 
> **Time from rheum ref or last GP to rheum appt (combined; includes those with
>  no rheum ref)
> gen time_refgp_rheum_appt = time_ref_rheum_appt
> replace time_refgp_rheum_appt = time_gp_rheum_appt if time_ref_rheum_appt==. 
> & time_gp_rheum_appt!=.
> tabstat time_refgp_rheum_appt, stats (n mean p50 p25 p75)
> 
> */
. 
. *What was first ULT drug in GP record========================================
> ======================================*
. 
. **Within 6 months of diagnosis
. gen first_ult_d_6m=""
(36,635 missing values generated)

. foreach var of varlist first_allo_date first_febux_date {
  2.         replace first_ult_d_6m="`var'" if first_ult_date==`var' & first_ul
> t_date!=. & (`var'<=(gout_code_date+180)) & `var'!=.
  3.         }
(0 real changes made)
(0 real changes made)

. gen first_ult_drug_6m = substr(first_ult_d_6m, 1, length(first_ult_d_6m) - 5)
>  if first_ult_d_6m!="" 
(36,635 missing values generated)

. drop first_ult_d_6m

. replace first_ult_drug_6m="Febuxostat" if first_ult_drug_6m =="first_febux"
(0 real changes made)

. replace first_ult_drug_6m="Allopurinol" if first_ult_drug_6m =="first_allo"
(0 real changes made)

. lab var first_ult_drug_6m "First ULT drug"

. 
. tab first_ult_drug_6m, missing

  First ULT |
       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
            |     36,635      100.00      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab first_ult_drug_6m if ult_6m==1, missing

  First ULT |
       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
            |      1,802      100.00      100.00
------------+-----------------------------------
      Total |      1,802      100.00

. 
. **Within 12 months of diagnosis
. gen first_ult_d_12m=""
(36,635 missing values generated)

. foreach var of varlist first_allo_date first_febux_date {
  2.         replace first_ult_d_12m="`var'" if first_ult_date==`var' & first_u
> lt_date!=. & (`var'<=(gout_code_date+365)) & `var'!=.
  3.         }
variable first_ult_d_12m was str1 now str15
(1 real change made)
variable first_ult_d_12m was str15 now str16
(1 real change made)

. gen first_ult_drug_12m = substr(first_ult_d_12m, 1, length(first_ult_d_12m) -
>  5) if first_ult_d_12m!="" 
(36,633 missing values generated)

. drop first_ult_d_12m

. replace first_ult_drug_12m="Febuxostat" if first_ult_drug_12m =="first_febux"
(1 real change made)

. replace first_ult_drug_12m="Allopurinol" if first_ult_drug_12m =="first_allo"
(1 real change made)

. lab var first_ult_drug_12m "First ULT drug"

. 
. tab first_ult_drug_12m, missing

  First ULT |
       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
            |     36,633       99.99       99.99
Allopurinol |          1        0.00      100.00
 Febuxostat |          1        0.00      100.00
------------+-----------------------------------
      Total |     36,635      100.00

. tab first_ult_drug_12m if ult_12m==1, missing

  First ULT |
       drug |      Freq.     Percent        Cum.
------------+-----------------------------------
            |      3,372       99.94       99.94
Allopurinol |          1        0.03       99.97
 Febuxostat |          1        0.03      100.00
------------+-----------------------------------
      Total |      3,374      100.00

. 
. save "$projectdir/output/data/file_gout_all.dta", replace
(note: file /workspace/output/data/file_gout_all.dta not found)
file /workspace/output/data/file_gout_all.dta saved

. 
. **Import prevalence and denominator for prevalence=========================*/
. 
. import delimited "$projectdir/output/measures/measure_prevalent_gout.csv", cl
> ear
(5 vars, 18 obs)

. 
. gen date_dstr = date(date, "YMD") 

. format date_dstr %td

. drop date

. rename date_dstr date

. gen year=year(date)

. format year %ty

. drop value //will round and calculate prevalence at analysis step

. 
. bys year: egen pop_all = total(population)

. bys year: egen prev_gout_all = total(prevalent_gout)

. rename prevalent_gout prev_gout

. rename population pop

. save "$projectdir/output/data/gout_prevalence_sex_long.dta", replace
(note: file /workspace/output/data/gout_prevalence_sex_long.dta not found)
file /workspace/output/data/gout_prevalence_sex_long.dta saved

. 
. **Import denominator for incidence=========================*/
. 
. import delimited "$projectdir/output/measures/measure_pre_registration.csv", 
> clear
(5 vars, 18 obs)

. 
. summ value //check - what proportion of individuals have 12 months of precedi
> ng registration

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       value |         18    .9799998    .0003934    .979412    .980605

. 
. gen date_dstr = date(date, "YMD") 

. format date_dstr %td

. drop date

. rename date_dstr date

. gen year=year(date)

. format year %ty

. drop value //will round and calculate prevalence at analysis step

. 
. drop population

. rename pre_registration pop_inc

. bys year: egen pop_inc_all = total(pop_inc)

. save "$projectdir/output/data/gout_incidence_sex_long.dta", replace
(note: file /workspace/output/data/gout_incidence_sex_long.dta not found)
file /workspace/output/data/gout_incidence_sex_long.dta saved

. 
. **Import admissions and denominators for admissions=========================*
> /
. 
. import delimited "$projectdir/output/measures/measure_gout_admission_pop.csv"
> , clear
(5 vars, 18 obs)

. 
. gen date_dstr = date(date, "YMD") 

. format date_dstr %td

. drop date

. rename date_dstr date

. gen year=year(date)

. format year %ty

. drop value //will round and calculate prevalence at analysis step

. 
. bys year: egen pop_all = total(population)

. bys year: egen gout_admission_all = total(gout_admission)

. rename population pop

. save "$projectdir/output/data/gout_admissions_sex_long.dta", replace
(note: file /workspace/output/data/gout_admissions_sex_long.dta not found)
file /workspace/output/data/gout_admissions_sex_long.dta saved

. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/cleaning_dataset.log
  log type:  text
 closed on:  23 Feb 2023, 14:07:08
-------------------------------------------------------------------------------
